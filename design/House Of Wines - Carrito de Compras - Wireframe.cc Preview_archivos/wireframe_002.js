var multipaged;$(function(){$canvas.offset();$("#show-bg").hide(),$("#canvas .txtcont span:empty").length&&$(".txtcont span:empty").text(paragraphtext),$("#canvas .listcont:empty").length&&$(".listcont:empty").each(function(){var e=$(this).parent().attr("data-color");$(this).html(list).find("li span").css({"background-color":e})}),imgs=$(".device-wrap span"),$("#canvas .wire").not(".grouped").has(".headlinetxt").addClass("hastext"),activepage.find(".wire").not(".groupmember").each(function(e,t){$(t).attr("id")||($(t).attr("id","w"+(new Date).getTime()),computeGuides($(t)))}),multipaged||computeGuides(activepage.find(" > .wire")),$(".textnew.ui-draggable").draggable("destroy"),$canvaswrap.center(),$("#canvas .locked").draggable("destroy").resizable("destroy"),multipaged?make_page_active(activepage.attr("id")):(activepage=$("#canvas"),applyTemplate($canvaswrap.data("device"),$canvaswrap.data("orientation")))}),$("#canvas .wire").not("#canvas .wire:has(.wirejr)").css({"border-style":"solid"}),multipaged=!!$("#canvas .page").length;var imgs,resizingInProgress,innerOffsetX,innerOffsetY,previewMode,$container=$(".container"),supercanvas=$(".supercanvas"),exporting=$(".exporting"),gridsize=0,wirePresent=!0,wirepanel=$("#wirepanel"),$canvaswrap=$("#canvas-wrap"),annotPresent=!0,offset_c=$("#canvas").offset(),cwidth=$("#canvas-wrap").width(),MIN_DISTANCE=7,guides=[],$showgrid=$("#show-grid"),$snaptogrid=$("#snap-to-grid"),$snaptoguides=$("#snap-to-guides"),$drawsnap=$("#draw-snap"),$transformsnap=$("#transform-snap"),$guideH=$("#guide-h"),$guideV=$("#guide-v"),$guidesHV=$("#guide-v , #guide-h"),$selectgridtype=$("select#grid-type"),$options=$(".options"),$statsCoord=$(".stats-coord"),$statsDim=$(".stats-dim"),offseta1=$("#canvas").offset(),clonewidth=0,cloneheight=0,$canvas=$("#canvas"),index_highest=0,sttngs=$(".settings span i"),sett=$(".settings"),$sitemapicon=$("#sitemap icon i"),$dim=$(".dim"),$body=$("body"),$edittxt=$("#edittxt");$container.hasClass("preview")&&(previewMode=!0);var appSettings={fixedToolbar:!0,drawOnTop:!1,snapOnDraw:!0,snapTo:1,snapToGuides:!0,transformSnap:!0,drawSnap:!0,snapToGrid:!1,snapToCol:!1,gridSize:20,gridType:"graph",showGrid:!0,showCol:!1,iconPack:"md",defaultStyle:{fill:"#fff",stroke:"#444",width:1}};applySettings();var paragraphArr=["Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel.","Lorem","ipsum","dolor","sit","amet","et","delectus","accommodare","his","consul","copiosae","legendos","at","vix","ad","putent","delectus","delicata","usu.","Vidit","dissentiet","eos","cu","eum","an","brute","copiosae","hendrerit.","Eos","erant","dolorum","an.","Per","facer","affert","ut.","Mei","iisque","mentitum","moderatius","cu.","Sit","munere","facilis","accusam","eu","dicat","falli","consulatu","at","vis.","Te","facilisis","mnesarchum","qui","posse","omnium","mediocritatem","est","cu.","Modus","argumentum","ne","qui","tation","efficiendi","in","eos.","Ei","mea","falli","legere","efficiantur","et","tollit","aliquip","debitis","mei.","No","deserunt","mediocritatem","mel."];function updateCanvasInput(e,t){var a=e||parseInt($canvaswrap.width(),10),i=t||parseInt($canvaswrap.height(),10);$(".canvassize").html("<b>canvas</b>: "+a+"/"+i+"px"),$("#canvas_w_val").val(a),$("#canvas_h_val").val(i),computeGuides("#canvas")}function turnColOn(){$("#show-grid").removeAttr("checked"),$("#gridcol").show(),$canvaswrap.attr({"data-col":"true","data-grid-type":"false","data-grid-show":"false"}),$("#grid-div , #grid-dot").hide(),computeGuides("col")}function setgrid(){if(!$("#canvas #grid-div").length){$("#canvas").prepend($(".grids").show().contents().unwrap()),$("#show-grid").attr("checked",appSettings.showGrid);var e=appSettings.gridType||$canvaswrap.attr("data-grid-type")||$canvaswrap.attr("data-grid");switch("grid"==e&&(e="graph",saveSettings()),appSettings.showGrid?$("select#grid-type").val(appSettings.gridType):$("#grid-div , #grid-dot , #gridcol").hide(),e){case"graph":$("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("select#grid-type").val("graph");break;case"dots":$("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$("select#grid-type").val("dots");break;case"false":$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1);break;default:$("#grid-div , #grid-dot , #gridcol").hide(),$("#show-grid").attr("checked",!1)}!appSettings.showCol&&"true"!==$canvaswrap.attr("data-col")||($("#grid-div , #grid-dot").hide(),$("#gridcol").show(),$("#show-grid").attr("checked",!1),$("#show-columns").attr("checked",!0),computeGuides("col"))}var t;0<(gridsize=appSettings.gridSize||$canvaswrap.attr("data-grid-size")||$canvaswrap.attr("snappy"))&&(appSettings.snapToGrid||"true"===$canvaswrap.attr("data-grid-snap"))?($canvaswrap.removeAttr("snappy"),$(".grid-size-val").text(appSettings.gridSize),$snaptogrid.attr("checked",!0),$("#show-columns").attr("checked",!1),$("#gridcol").hide(),appSettings.snapToGuides=!1,appSettings.snapToGrid=!0,appSettings.snapToCol=!1,$snaptoguides.attr("checked",!1),updategrid(appSettings.gridSize),$("#grid-slider").slider("value",appSettings.gridSize)):appSettings.showCol||"col"==gridsize&&$canvaswrap.data("col")||$canvaswrap.data("col")?($snaptogrid.attr("checked",!1),$snaptoguides.attr("checked",!0),$("#show-columns").attr("checked",!0),appSettings.snapToGuides=!0,appSettings.snapToGrid=!1,appSettings.snapToCol=!0,$selectgridtype.val("col"),gridsize=0,$("#gridcol").show()):(updategrid(t=appSettings.gridSize||20),$("#grid-slider").slider("value",t),$(".grid-size-val").text(t));$canvaswrap.attr("data-grid-show");appSettings.showGrid||$("#grid-div").hide(),saveSettings()}function lock(){var e;e=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected"),$("#lock").addClass("pressed"),e.length&&!$("#canvas .selected.locked").length?(e.addClass("locked").draggable("destroy").resizable("destroy").radiusable("destroy").radiusable("destroy"),saveState(e)):$("#canvas .selected.locked").length&&($("#canvas .selected.locked").removeClass("locked icon-").unbind("click").data("draggable",!1),$("#lock").removeClass("pressed"),makeDrag(e))}function unlock(e){e.removeClass("locked icon-").unbind("click").data("draggable",!1),$("#lock").removeClass("pressed"),makeDrag(e)}$(document).ready(function(){previewMode||setgrid(),updateCanvasInput(),positionAA()}),populateLoremText(),$("#show-grid").bind("change",function(){$(this).is(":checked")?($("#show-columns").removeAttr("checked"),$("#gridcol").hide(),removeGuides(".col"),$canvaswrap.attr({"data-col":"false","data-grid-show":"true"}),$("select#grid-type").val(appSettings.gridType),"graph"==appSettings.gridType?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$canvaswrap.attr("data-grid-type","graph")):"dots"==appSettings.gridType&&($("#grid-dot").show(),$("#gridcol , #grid-div").hide(),$canvaswrap.attr("data-grid-type","dots")),appSettings.showGrid=!0):($("#grid-div , #grid-dot").hide(),$canvaswrap.attr("data-grid-show","false"),appSettings.showGrid=!1),appSettings.showGrid=$(this).is(":checked"),appSettings.showCol=!appSettings.showGrid,saveSettings()}),$("#show-columns").bind("change",function(){$(this).is(":checked")?(turnColOn(),appSettings.showCol=!0,appSettings.showGrid=!1,appSettings.snapToGrid=!1):($("#gridcol").hide(),$canvaswrap.attr("data-col","false"),removeGuides(".col"),appSettings.showCol=!1),saveSettings()}),$("select#grid-type").change(function(){"graph"==$("select#grid-type").val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid-type","graph"),appSettings.snapToCol=!1,appSettings.gridType="graph",removeGuides(".col")):"dots"==$("select#grid-type").val()&&($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$("#show-grid").attr("checked","checked"),$canvaswrap.attr("data-grid-type","dots"),appSettings.snapToCol=!1,appSettings.gridType="dots",removeGuides(".col")),saveSettings()}),$("#show-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").show(),$("#hide-annotation").show(),$(this).hide()}),$("#hide-annotation").click(function(){$("#canvas .aa , #canvas .publiccomment").hide(),$("#show-annotation").show(),$(this).hide()}),$("#edit-wire").click(function(){$("#canvas .selected").dblclick()}),$("#lock").click(function(){lock()});var $ajaxlogin=$("#ajaxlogin"),supports_pushState="pushState"in history;function showSaveButton(){$("#slogan").fadeOut("fast",function(){$(".controls").fadeIn(),$("#links").addClass("linksmin")})}function InstantShowSaveButton(){$("#slogan").hide(),$("#links").addClass("linksmin"),$("#demo").hide(),$(".controls").show()}$("#save").click(function(){$("#canvas-wrap").find(" > .ui-resizable-handle").remove(),activepage.find(".selected").removeClass("selected"),wirepanel.hide(),activepage.add("#canvas > .master-on").find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v"),quill&&blurRTE(),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-re"),$("#canvas .master-on.ui-draggable").draggable("destroy");var t=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment, form , option , xmp , textarea , plaintext , grammarly-btn , grammarly-ghost, a").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),a=encodeURIComponent(t),i="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),i+=$(this).outerHTML()});var s=encodeURIComponent(i);$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:s},success:function(e){switch(e){case"login":localStorage.setItem(filename,t),localStorage.setItem(filename+"aa",i),$ajaxlogin.find(".wrongpass").hide(),$ajaxlogin.show().submit(function(e){e.preventDefault(),$.ajax({type:"POST",url:"../ps/ajaxlogin.php",data:$ajaxlogin.serialize(),success:function(e){0==e?$ajaxlogin.find(".wrongpass").show():$.ajax({type:"POST",url:"../save",data:{note:a,name:filename,aa:s},success:function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeAADrag($("#canvas .publiccomment , #canvas .aa")),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa"),$ajaxlogin.hide(),_paq.push(["trackGoal",3])}})}})}),_paq.push(["trackGoal",2]);break;default:$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeAADrag($("#canvas .publiccomment , #canvas .aa")),localStorage.removeItem(filename),localStorage.removeItem(filename+"aa")}},error:function(){localStorage.setItem(filename,t),localStorage.setItem(filename+"aa",i),MakeCanvasDrag(),$("#canvas .publiccomment , #canvas .aa").draggable().resizable({handles:"n,e,w,s"}),_paq.push(["trackGoal",1])}})}),$("#fork").click(function(){activepage.find(".selected").removeClass("selected"),activepage.add("#canvas > .master-on").find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v"),quill&&blurRTE(),$("#canvas .wire , #canvas .aa , #canvas .publiccomment").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var e=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find(".aa , .publiccomment , form , option , xmp , textarea , plaintext , grammarly-btn , grammarly-ghost, a").remove().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),t=encodeURIComponent(e),a="";$("#canvas .publiccomment , #canvas .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),a+=$(this).outerHTML()});var i=encodeURIComponent(a),s=$.now();$.post("../fork",{note:t,name:filename,aa:i,timestamp:s},function(){$(".saved").show().delay(600).fadeOut(),MakeCanvasDrag(),makeAADrag($("#canvas .publiccomment , #canvas .aa"))})}),$("#savefree").click(function(){var e=!0;$canvas.find(".selected").removeClass("selected").end().find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v"),quill&&blurRTE(),$("#canvas .wire , #canvas .aa ").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-re"),$canvaswrap.resizable("destroy");var t=$(".supercanvas").clone().find(".txtcont span").empty().end().find(".listcont").empty().end().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot , form , option , xmp , textarea , plaintext , grammarly-btn , grammarly-ghost, a").remove().end().find(".text-lorem [data-lorem-count] .textme").empty().end().htmlClean().html(),a=encodeURIComponent(t);0===filename?filename=randomID(6):e=!1,supports_pushState?history.pushState({},"filename","/"+filename):location.hash="#"+filename,$.post("save.php",{note:a,name:filename},function(){MakeCanvasDrag(),e?($("body").addClass("show-save-modal"),$(".savedURL").text("https://wireframe.cc/"+filename)):$(".saved").fadeIn(160).delay(800).fadeOut(100),saveThumbAndData(filename),makeAADrag($("#canvas .aa"))})}),$("#canvas").on("click",".closeannot",function(){$(this).parent().remove(),previewMode&&saveComment()}),previewMode?$("#canvas").on("click",".publiccomment .annotbox div",divClicked):$("#canvas").on("click",".annotbox div",divClicked);var quill,$rteToolbar=$("#wcc-toolbar");function edittext(e,t,l){var c,p,h,a,i,s,n,o,r,d,g,u,f,v,m,w;previewMode||(wirepanel.hide(),$guidesHV.hide(),supercanvas.addClass("rich-text-active"),e.stopPropagation(),removeMarkedElemBorder(),c=$(t),p=c.parents(".wire").not(".grouped"),h=p.attr("id"),l||p.removeClass("thelatest").not(".text21").find(".textme").each(function(e,t){updateTextTo21(t)}),l||p.find(".wirejr").removeClass("new").css({"border-width":"","border-color":"",background:""}),saveState(p),a=Math.round(p.position().left+p.width()/2),i=p.position().top-64,a<222-($canvaswrap.offset().left<0?$canvaswrap.offset().left:0)&&(a=232-($canvaswrap.offset().left<0?$canvaswrap.offset().left:0)),p.position().top+$canvas.offset().top-30<60&&(s=p.position().top,$container.scrollTop(s+$canvaswrap.position().top-120)),a+202+$canvas.offset().left>$(window).width()&&(a=$(window).width()-232-$canvas.offset().left),a+330+$canvas.offset().left>$(window).width()&&$container.addClass("ql-edge-case-e"),c.attr("id","sel-text").removeClass("ql-editor"),p.addClass("edited-text text21"),p.addClass("rich-text").removeAttr("contenteditable"),l?$("body").addClass("edit-btn"):p.removeClass("selected").resizable("destroy").draggable("destroy").radiusable("destroy"),p.addClass("editingtext").find(".wirejr").css("height","auto"),$("#wcc-toolbar-instance").length||$("#wcc-toolbar").clone(!0,!0).attr("id","wcc-toolbar-instance").appendTo("#canvas-wrap").css({left:a,top:i,display:function(){return l?"none":"block"}}),n=Quill.import("attributors/class/color"),o=Quill.import("attributors/style/size"),Quill.register(n,!0),Quill.register(o,!0),o.whitelist=["12px","14px","22px","28px","42px"],n.whitelist=["f","d","a","h7","h4","h1","t"],r=document.getElementById("sel-text"),d=Quill.import("parchment"),g=["1",!1,"1.3","1.4","1.5","1.6","1.8","2","3","4"],u=new d.Attributor.Style("lh","line-height",{whitelist:g}),f=new d.Attributor.Style("customfontsize","font-size",{whitelist:["12px","14px",!1,"22px","28px","42px"]}),v=new d.Attributor.Class("ttu","ql-ttu",{scope:d.Scope.INLINE}),m=new d.Attributor.Class("smallcaps","ql-sc",{scope:d.Scope.INLINE}),Quill.register({"formats/lh":u,"formats/ttu":v,"formats/smallcaps":m,"formats/customfontsize":f}),quill=new Quill(r,{debug:"false",bounds:"#container",formats:["bold","color","size","italic","underline","list","align","lh","ttu","smallcaps","customfontsize"],scrollingContainer:"#canvas",modules:{toolbar:"#wcc-toolbar-instance",history:{delay:1e3,maxStack:50,userOnly:!1}},theme:"snow"}),$("#wcc-toolbar-instance #font-size-ui-slider").show(),setFontSizeSlider(1),(w=p.find(".textme").data("text-format"))&&(quill.formatText(0,quill.getLength(),{bold:w.bold,align:w.align,customfontsize:w.size,color:w.color}),p.find(".textme").removeData("text-format")),activepage.find("#sel-text [contenteditable=true]").attr("spellcheck",!1),c.parents(".wirejr").data("lorem-count")&&c.bind("keydown",function(e){$(this).unbind("keydown").parents(".wirejr").removeAttr("data-lorem-count").parent().removeClass("text-lorem").css({height:c.height(),width:c.width()})}),l&&(p.find(".ql-editor").css("width","auto").on("mousedown click",function(e){e.stopPropagation()}),p.find(".textme").on("click",function(){blurRTE(),editme(p)}),1==quill.getLength()&&quill.formatText(0,quill.getLength(),{align:"center"}),setVertAlignBtn(p.find(".textme").css("vertical-align")),$("#wcc-toolbar-instance .ql-vertical-align").on("mouseup",".ql-picker-item",function(e){setVerticalAlignment(p,$(this).attr("data-value"))})),l&&!p.hasClass("empty-btn")&&"\n"==quill.getText()&&p.addClass("empty-btn"),quill.on("text-change",function(e,t,a){return!!quill&&(c.parents(".wirejr").data("lorem-count")&&c.parents(".wirejr").removeAttr("data-lorem-count").parent().removeClass("text-lorem").css({height:c.height(),width:c.width()}),l&&(i=p.hasClass("empty-btn"),quill.getText()&&!$("body").hasClass("edit-btn")?($("body").addClass("edit-btn"),$("#wcc-toolbar-instance").show(),render_edit_menu(),positionwirepanel(p,null,1),positionTextWirepanel()):$("body").hasClass("edit-btn")||(render_edit_menu(),positionwirepanel(p,null,1)),i&&(wirepanel.hide(),$("#wcc-toolbar-instance").show(),positionTextWirepanel()),s=c.width(),n=c.height(),r=(o=c.parents(".wire")).width(),d=o.height(),r<=s+4&&(o.add(c).css("width",s+6),o.radiusable("positionHandles")),d<n+4&&(o.add(c).css("height",n+6),o.radiusable("positionHandles")),(i&&quill.selection.lastRange&&0<quill.selection.lastRange.index||1<quill.history.stack.undo.length)&&p.removeClass("empty-btn")),editorHistory[h]={},editorHistory[h].history={},editorHistory[h].delta={},editorHistory[h].history=quill.history,editorHistory[h].delta=quill.editor.delta,void(quill.selection.lastRange&&quill.selection.lastRange.length&&setFontSizeSlider(quill.selection.lastRange.index)));var i,s,n,o,r,d}),quill.on("selection-change",function(e,t,a){!p.hasClass("empty-btn")&&quill.selection.lastRange&&0<quill.selection.lastRange.index&&p.removeClass("empty-btn"),e&&(setFontSizeSlider(e.index),c.parents().hasClass("btn")&&($("body").addClass("edit-btn"),p.hasClass("empty-btn")?(wirepanel.show(),render_edit_menu(),positionwirepanel(p,null,1),positionTextWirepanel()):(wirepanel.hide(),$("#wcc-toolbar-instance").show())))}),editorHistory[h]&&(quill.history.stack=editorHistory[h].history.stack),setTimeout(function(){var e={top:$container[0].scrollTop,left:$container[0].scrollLeft};quill.setSelection(0,quill.getLength()),$container.scrollTop(e.top).perfectScrollbar("update"),$container.scrollLeft(e.left).perfectScrollbar("update")},10),$("#sel-text").find("p,li").has(".ql-lh-1").addClass("lh-1").css("line-height","1"),setFontSizeSlider(1),$("#wcc-toolbar-instance #line-height-ui-slider").slider({min:0,max:g.length-1,value:1,start:function(e,t){$(this).find(".val-label").show()},slide:function(e,t){quill.format("lh",g[t.value]);t.value},stop:function(e,t){$(this).find(".val-label").hide()}}),$("#wcc-toolbar-instance #font-size-ui-slider").slider({min:0,max:5,value:2,start:function(e,t){e.preventDefault()},slide:function(e,t){var a=t.value;quill.format("customfontsize",["12px","14px",!1,"22px","28px","42px"][a])}}),$("#wcc-toolbar-instance #wcc-toolbar-more").bind("click",function(e){$("#wcc-toolbar-instance").toggleClass("wcc-more-options").find(".ql-picker.ql-expanded").removeClass("ql-expanded")}),$("#wcc-toolbar-instance").bind("mouseenter",function(e){e.stopPropagation(),quill.getSelection()&&0<quill.getSelection().length&&(quill.preservedSel=quill.getSelection()),quill.stopChangeEvent=!0}),$("#wcc-toolbar-instance").bind("mouseleave",function(e){quill.preservedSel=null}),$("#wcc-toolbar-instance").on("mouseup",".ql-picker-item , .ql-picker , button, .ui-slider-handle",function(e){$(this).is(".ql-picker")&&$("#wcc-toolbar-instance").removeClass("wcc-more-options").find(".ql-picker.ql-expanded").not(this).removeClass("ql-expanded"),null!==quill.getSelection()&&0!=quill.getSelection().length&&quill.getSelection().index===quill.preservedSel.index||quill.setSelection(quill.preservedSel),quill.stopChangeEvent=!1}).on("click",".ql-vertical-align",function(e){$(this).addClass("ql-expanded")}))}function focustext(){activepage.find(".editingtext [contenteditable=true]").focus()}var activepage,mousedownHappened=!1,editorHistory={};function blurRTE(){if(!quill)return!1;$("#rich-text-overlay").remove(),$("#wcc-toolbar-instance").remove(),$("#sel-text").unbind("keydown");var e,t=$("#sel-text"),a=activepage.find("#sel-text").eq(0).parents(".wire").not(".grouped");a.data("text-event-bound",!1),e=!!a.hasClass("btn");a.attr("id");var i=activepage.find("#sel-text").height();supercanvas.removeClass("rich-text-active"),$container.removeClass("ql-edge-case-e ql-edge-case-n");var s=quill.getText();"\n"!=s||e||a.remove(),quill=null,"Lorem"!==s.split(" ")[0]&&t.parents(".wirejr").data("lorem-count")&&t.parents(".wirejr").removeAttr("data-lorem-count").parent().removeClass("text-lorem").css({height:t.height(),width:t.width()});var n;$("#sel-text .ql-editor").html(),new RegExp("(?![^<]+>) ","gi");a.find(".ql-editor").attr("contenteditable","false"),$("*",a.find(".ql-editor")).each(function(){$(this).html(function(e,t){return t.replace(/^ */,function(e){return Array(e.length+1).join("&nbsp;")})})}),n=a.find(".ql-editor").html(),e||a.css({height:i}),a.removeClass("edited-text editingtext"),a.css({"z-index":"auto"}).find(".textme").removeClass("thelatest ql-container ql-snow").addClass("ql-editor").removeAttr("id").html(n).end(),e&&($("body").removeClass("edit-btn min-btn"),"\n"==s&&a.removeClass("text21 rich-text").addClass("empty-btn btn").find(".textme").removeClass("ql-editor").empty(),positionwirepanel(),a.find(".textme").off().end().find(".wirejr").off(),a.draggable("enable")),computeGuides(a)}function unselectAll(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function modernizeWire(){$canvas.find(".textme").attr("contenteditable",!1)}function textblur(){previewMode||useboxer();var e=$canvas.find(".editingtext");e.css("height");e.parent().parent().parent().css("z-index","auto");var t=e.val().replace(/\n/gi,"<br>"),a=$("<div>");""===t&&(t="..."),a.html(t).addClass("textme"),e.replaceWith(a),a.closest(".wire").css({height:a.height(),position:"absolute"}),a.closest(".wirejr").draggable("destroy"),$("textarea.editingtext").remove()}function divClicked(e){supercanvas.boxer("destroy"),$(this).parent().addClass("latest");var t=$(this).html().replace(/<br>/gi,"\n"),a=$("<textarea class='editingtext'/>");a.val($("<div />").html(t).text()).addClass("textareanow"),$(this).replaceWith(a),a.focus(),a.blur(editableTextBlurred),$(".latest .ok").show(),$("textarea").autoResize(),$(".annotbox").addClass("textareainside"),$(".ok").click(editableTextBlurred)}function editableTextBlurred(){previewMode||useboxer(),$t=$(".textareanow"),$t.parent().removeClass("latest");var e=$t.val().replace(/\n/gi,"<br>"),t=$("<div>");""===e&&(e="..."),t.html(e).insertBefore($t).click(divClicked),$t.remove(),$(".ok").hide(),previewMode&&(saveComment(),t.parent().parent().draggable({cancel:".annotbox , .closeannot",cursor:"move"}).resizable({handles:"n,e,w,s"}))}function selectColliders(e){var a={},t=activepage.find(".selecting");a.top=e.box.position().top,a.left=e.box.position().left,a.right=e.box.position().left+Number(t.width()),a.bottom=e.box.position().top+Number(t.height());var i=$();activepage.find(".wire").not(".brandnew, .locked, .groupmember").each(function(){var e=$(this),t={};t.top=e.position().top,t.left=e.position().left,t.right=Number(e.position().left)+Number(e.width()),t.bottom=Number(e.position().top)+Number(e.height()),a.right>=t.right&&a.left<=t.left&&a.top<=t.top&&a.bottom>=t.bottom&&(i=i.add(e))}),i.length&&(makeDrag(i,1<i.length),selectWire(i,null,1<i.length),controlIconsShow())}function findColliders(){var t={},e=activepage.find(".brandnew");t.top=e.offset().top/zoomfactor,t.left=e.offset().left/zoomfactor,t.right=Number(e.offset().left/zoomfactor)+Number(e.width()),t.bottom=Number(e.offset().top/zoomfactor)+Number(e.height());var a=$();activepage.find(".wire").not(".brandnew, .locked, .groupmember").each(function(){var e={};e.top=$(this).offset().top/zoomfactor,e.left=$(this).offset().left/zoomfactor,e.right=Number($(this).offset().left/zoomfactor)+Number($(this).width()),e.bottom=Number($(this).offset().top/zoomfactor)+Number($(this).height()),t.right>=e.right&&t.left<=e.left&&t.top<=e.top&&t.bottom>=e.bottom&&($(this).addClass("selected"),a=a.add($(this)))})}function useboxer(){supercanvas.boxer({cursor:"pointer",stop:function(e,t){var a,i,s;draggingInProgress=!1,$canvaswrap.removeClass("draggingInProgress"),$(".brandnew").hasClass("selecting")?(selectColliders(t),$canvas.find(".selected.locked").length&&0===$canvas.find(".selected:not(.locked)").length&&$("#lock").addClass("pressed"),$canvas.find(".selected.grouped").length&&0===$canvas.find(".selected:not(.grouped)").length&&$("#group").addClass("pressed"),$("#canvas .brandnew").remove()):(t.box.height(),t.box.width(),10<t.box.width()&&10<t.box.height()?($("#icons").show().siblings().hide(),aspect_ratio($("#canvas .blank")),$("#annotate").show(),$("#textinput").removeClass("lasticon"),i=(a=t.box.position()).top,a.left,$("#canvas-wrap").position().top,wirepanel.show().css({top:0,left:0,width:"auto"}),positionwirepanel()):($(e.target).parents(".master-on").length?selectMaster(e.target):$(e.target).hasClass("wirejr")||$(e.target).hasClass("textme")?selectWire($(e.target).parents(".wire"),e.shiftKey||e.metaKey||e.ctrlKey):$(e.target).hasClass("wire")&&selectWire($(e.target),e.shiftKey||e.metaKey||e.ctrlKey),!($(e.target).is("#grid")||$(e.target).is(".ui-boxer-helper")||$(e.target).is(".col"))||(s=supercanvas.data("originalEventTarget"))&&(s.hasClass("wirejr")||s.hasClass("wire"))&&selectElem(s),t.box.remove()))}})}function prepareWire(e,t){var a,i,s,n=$(".brandnew"),o=n.height(),r=n.width(),d="white"==appSettings.defaultStyle.fill?"":appSettings.defaultStyle.fill,l="white"==appSettings.defaultStyle.fill?"":appSettings.defaultStyle.fill,c="#444"==appSettings.defaultStyle.stroke?"":appSettings.defaultStyle.stroke,p=r-2*appSettings.defaultStyle.width+(0<(gridsize&&appSettings.snapToGrid)?1:0),h=o-2*appSettings.defaultStyle.width+(0<(gridsize&&appSettings.snapToGrid)?1:0);"w-icon"==e&&(d=l=c="",h<p&&(p=h),p<h&&(h=p)),n.removeAttr("class").addClass("wirejr brandnew blank latestwire").empty().css({background:d,width:p,height:h,"border-width":l,"border-color":c,color:"#444"==appSettings.defaultStyle.stroke?"":appSettings.defaultStyle.stroke}),n.addClass(e),"w-icon"==e&&n.append('<svg><use xlink:href="#'+t+'"></use></svg>'),"annotate"==e&&makeAADrag($(".brandnew.annotate").removeClass("wire").addClass("aa").append(annotationhtml)),"slider2"!=e&&"line_hor"!=e||n.addClass("resizeX"),"slider"==e&&n.removeClass("slider").addClass("slider2").append("<span>"),"line_hor"==e&&n.css("margin-top",o/2),"paragraph"==e&&n.append(paragraph).find("span").css("background",appSettings.defaultStyle.stroke),"textinput"==e&&n.removeClass("textinput").addClass("textinput2").append("<span>|</span>"),"combobox"==e&&n.removeClass("combobox").addClass("combobox2").append("<span>&#9660;</span>"),"scrollh"==e&&n.removeClass("scrollh").addClass("scrollh2").append("<span class='arrL'>&#9664;</span>").append("<span >&#9654;</span>"),"progressbar"==e&&n.removeClass("progressbar").addClass("progressbar2").append("<span></span>"),"list"==e&&n.append(list).find("span").css("background",appSettings.defaultStyle.stroke),"headlinetxt"==e&&n.addClass("textnew text21 text-arimo ").css("height",function(){return o<21?21:21*Math.floor(o/21)}).append('<div class="textme">').find(".textme").append(paragraphtext),n.hasClass("headline")&&$(".brandnew.headline").html(headtxt).find(".headtext span").css("background",appSettings.defaultStyle.stroke),n.hasClass("image")&&(n.svg(),a=n.width(),i=n.height(),(s=n.svg("get")).line(0,i,a,0,{class:"line1",stroke:appSettings.defaultStyle.stroke,strokeWidth:appSettings.defaultStyle.width}),s.line(0,0,a,i,{class:"line2",stroke:appSettings.defaultStyle.stroke,strokeWidth:appSettings.defaultStyle.width}),n.addClass("hasSVG").css("borderWidth",appSettings.defaultStyle.width)),insertWire(e,t)}function insertWire(e,t){var a,i,s,n,o,r,d,l,c;$(".brandnew").length&&("annotate"!==e?((a=$(".brandnew")).wrap("<div class='wire'></div>"),i=a.closest(".wire"),s=a.width(),n=a.height(),r=(o=a.position()).top,d=o.left,parseInt(a.css("zIndex"),10),saveState("",[l="w"+(new Date).getTime()]),i.css({top:r,left:d,width:s+2*appSettings.defaultStyle.width,height:n+2*appSettings.defaultStyle.width}).attr("id",l),a.css({top:"",left:"",width:"",height:""}),a.is(".aa")&&a.css("z-index","5000").removeClass("wirejr")):$(".brandnew").removeClass("wirejr").css("z-index",5e3),"headlinetxt"==e&&(a.css({height:n,width:s}).parent().addClass("hastext selected text21 text-lorem"),c=a.find(".textme").getShowingText(),a.find(".textme").html(c.text).parents(".wirejr").removeClass("lastheadline thelatest"),!1===detectIE()&&a.attr("data-lorem-count",c.count),mousedownHappened=!1,a.find(".textme").trigger("editThisText")),"annotate"==e&&($(".thelatest").click(),wirepanel.hide()),computeGuides(i),$(".brandnew").removeClass("blank brandnew"),"headlinetxt"!==e&&"annotate"!==e?wirepanel.hide():focustext())}function makeDrag(e,t){t||!(e.find(".roundbox").length||e.find(".box").length||e.find(".combobox2").length||e.find(".btn").length)||e.hasClass("locked")||e.radiusable(),e.filter(".locked").data("draggable",!0).click(function(e){var t=$(this);if(event.ctrlKey||event.shiftKey||event.metaKey)return selectWire(t,1),void($canvas.find(".selected.locked").length?controlIconsShow:controlIconsHide)();0!=$("#canvas .brandnew").length||0!==$("#canvas .selected:not(.locked)").length||t.hasClass(".selected")||previewMode||(selectWire(t),controlIconsShow())});var n,r,d,s,o,l,c,p=!1;e.not(".groupmember , .wirejr , .locked").draggable({distance:2,helper:function(e){var t=activepage.find(".wire.selected").not(".locked");if(1<t.length&&$(this).hasClass("selected")){p=!0,t.addClass("multidrag").resizable("destroy").radiusable("destroy"),d=r=1e5,o=s=-1,t.each(function(){var e=$(this).position(),t=$(this).width(),a=$(this).height();r=r<e.top?r:e.top,d=d<e.left?d:e.left,s=s>e.left+t?s:e.left+t,o=o>e.top+a?o:e.top+a});var a=$("<div/>").css("box-shadow","0 0 0 1px rgb(65, 123, 238) inset"),i=$("<div/>").css({top:-r,left:-d,width:s-d,height:o-r,position:"relative"}).appendTo(a);return t.clone().resizable("destroy").radiusable("destroy").removeClass("selected").appendTo(i),t.addClass("draggable-original"),removeGuides(t),e.altKey&&$(this).addClass("altdrag"),a}return p=!1,$(this)},start:function(e,t){var a=$(this);if(draggingInProgress=!0,appSettings.snapToGuides&&!e.altKey&&(draggingInProgress={id:a.attr("id")}),$canvaswrap.addClass("draggingInProgress"),$guideH.hide(),$guideV.hide(),$canvas.data("guideH",!1),$canvas.data("guideV",!1),$canvaswrap.find(".brandnew").remove(),a.hasClass("selected")?saveState():saveState(a),k=parseInt($(this).css("borderLeftWidth"),10),$(".selected.locked").removeClass("selected"),t.helper.data("draggableXY.originalPosition",{top:t.helper[0].offsetTop,left:t.helper[0].offsetLeft}),t.helper.data("draggableXY.newDrag",!0),n=activepage.find(".selected:not(.locked)"),p)if(l=a.position().top,c=a.position().left,t.helper.css({"margin-top":r-l,"margin-left":d-c}),1!=e.altKey)n.addClass("transparent");else{if(e.metaKey||e.shiftKey)return;n.removeClass("selected")}showWireDim(a),wirepanel.hide(),n.children().removeClass("selected"),posTopArray=[],posLeftArray=[],parseInt(t.helper.css("margin-top"),10),parseInt(t.helper.css("margin-left"),10),innerOffsetX=e.pageX-this.offsetLeft,innerOffsetY=e.pageY-this.offsetTop;var i,s=[];$(e.target).parents(".wire.selected").length?activepage.find(" > .wire.selected").each(function(){s.push($(this).attr("id"))}):s.push($(e.target).parents(".wire.selected").attr("id")),s.push(a.attr("id")),a.data("thisId",s),a.is(".grouped")&&(i=[],a.find("  .groupmember").each(function(){i.push($(this).attr("id"))}),a.data("groupIds",i))},drag:function(e,t){var a,i,s,n,o;$(this);appSettings.snapToGuides&&!e.altKey&&$.extend(draggingInProgress,{heightcenter:t.position.top+t.helper[0].clientHeight/2,widthcenter:t.position.left+t.helper[0].clientWidth/2,left:t.position.left,top:t.position.top,right:t.position.left+t.helper[0].clientWidth,bottom:t.position.top+t.helper[0].clientHeight}),e.shiftKey&&(a=t.helper.data("draggableXY.originalPosition"),i=Math.abs(a.left-t.position.left),s=Math.abs(a.top-t.position.top),n=t.helper.data("draggableXY.newDrag"),t.helper.data("draggableXY.newDrag",!1),o=n?Math.max(i,s)===i:t.helper.data("draggableXY.xMax"),t.helper.data("draggableXY.xMax",o),t.position,o&&$(this).draggable("option","axis","x"),o||$(this).draggable("option","axis","y"));var r,d,l,c,p,h,g,u,f,v,m=$canvas.data("guideH"),w=$canvas.data("guideV");appSettings.snapToGuides&&!e.altKey&&(wireDistV=1e3,m&&($guideH.addClass("visible").css("transform","translateY("+(m.y+$canvas.offset().top+$container.scrollTop()-42)+"px)").show(),markAadjacentElement(m,snappedIdH),c=0,"bottom"==m.snappedEdge&&(c=t.helper.height()-1),"heightcenter"==m.snappedEdge&&(c=Math.round((t.helper.height()-1)/2)),t.position.top=m.y-c),w&&($guideV.addClass("visible").css("transform","translateX("+(w.x+$canvas.offset().left+$container.scrollLeft())+"px)").show(),markAadjacentElement(w,snappedIdV),l=0,"right"==w.snappedEdge&&(l=t.helper.width()-1),"widthcenter"==w.snappedEdge&&(l=Math.round((t.helper.width()-1)/2)),t.position.left=w.x-l)),0<gridsize&&appSettings.snapToGrid&&!e.altKey&&(r=t.position.left,d=t.position.top,l=$(this).outerWidth()-1,c=$(this).outerHeight()-1,p=t.position.left+l,h=t.position.top+c,snappedleft=Math.round(r/gridsize)*gridsize,snappedright=Math.round(p/gridsize)*gridsize,snappedtop=Math.round(d/gridsize)*gridsize,snappedbottom=Math.round(h/gridsize)*gridsize,g=Math.abs(snappedleft-t.position.left),u=Math.abs(snappedright-t.position.left-l),f=Math.abs(snappedtop-t.position.top),v=Math.abs(snappedbottom-t.position.top-c),t.position.left=g<u?snappedleft:snappedright-l,t.position.top=f<v?snappedtop:snappedbottom-c),showWireDim({x:parseInt(t.position.left,10),y:parseInt(t.position.top,10),w:t.helper[0].offsetWidth,h:t.helper[0].offsetHeight}),t.position.top=Math.round(t.position.top),t.position.left=Math.round(t.position.left)},stop:function(e,t){$canvas.data("guideH"),$canvas.data("guideV");$("#guide-v, #guide-h").hide(),draggingInProgress=!1,$canvaswrap.removeClass("draggingInProgress");var i,s,n,o;$(this);if(computeGuides($(this)),p&&(activepage.find("div.transparent").remove(),(i=t.helper.clone().find("> div > .wire")).first().parent().parent(),s=t.helper.position().left+parseInt(t.helper.css("margin-left"))-d,n=t.helper.position().top+parseInt(t.helper.css("margin-top"))-r,i.find(".ui-resizable-handle").remove(),$toApp=$(),o=[],i.each(function(e){$(this).is(".groupmember")&&i.unwrap().unwrap();var t=$(this);abspos={top:parseInt(t.css("top")),left:parseInt(t.css("left"))};var a="w"+(new Date).getTime()+e;t.css({top:abspos.top+n,left:abspos.left+s}),activepage.data("altdrag")&&(t.attr("id",a),o[e]=a),$toApp=$toApp.add(t)}),activepage.find(".draggable-original").removeClass("draggable-original").draggable("destroy"),$toApp.addClass("selected").removeData("draggable").appendTo(activepage),activepage.find(".multidrag").removeClass("multidrag"),makeDrag($toApp,!0),computeGuides($toApp),p=!1,activepage.data("altdrag")&&(activepage.data("altdrag",!1),historystate.shift(),saveState("",o))),$(this).hasClass("altdrag")||$(this).hasClass("multidrag"))appSettings.drawOnTop&&$(".altdrag").draggable("destroy").resizable("destroy"),$(".altdrag").removeClass("selected altdrag");else{if(appSettings.drawOnTop)return;deselectAll(),selectWire($(this))}$(this).draggable("option","axis","none"),removeMarkedElemBorder()}});var k=2;e.not(".groupmember , .wirejr , .locked,.grouped").resizable({autoHide:!0,destroy:function(e,t){$(this).find(".ui-border-radius-handle").remove()},start:function(e,t){multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected");var a=$(this);draggingInProgress=!0,appSettings.snapToGuides&&!e.altKey&&(draggingInProgress={id:a.attr("id")}),$canvaswrap.addClass("draggingInProgress"),resizingInProgress=!0,$canvas.data({guideH:!1,guideV:!1}),a.data({resizing:!0}),$guidesHV.hide(),a.data("resizable").handle=a.data("resizable").axis,$("#guide-v , #guide-h").hide(),handle=$(this).data("resizable").axis,saveState($(this)),k=parseInt($(this).find(".wirejr").css("borderLeftWidth"),10),wirepanel.hide(),a.data("thisId",$(this).attr("id")),$(this).find(".wirejr").hasClass("w-icon")&&(a.resizable("option","aspectRatio",!0).data("resizable")._aspectRatio=!0)},resize:function(e,a){var t,i,s=$(this).find(".wirejr.w-icon").length,n=$(this),o=n.data("resizable").handle;k=1,appSettings.snapToGuides&&!e.altKey&&("n"!==o&&"ne"!==o&&"nw"!==o||$.extend(draggingInProgress,{top:a.position.top}),"s"!==o&&"se"!==o&&"sw"!==o||$.extend(draggingInProgress,{bottom:a.position.top+a.size.height}),"w"!==o&&"sw"!==o&&"nw"!==o||$.extend(draggingInProgress,{left:a.position.left}),"e"!==o&&"se"!==o&&"ne"!==o||$.extend(draggingInProgress,{right:a.position.left+a.size.width}),$.extend(draggingInProgress,{isIcon:s}),t=$canvas.data("guideH"),i=$canvas.data("guideV"));var r,d,l,c,p,h,g,u,f,v,m,w,b,x=a.size.width,y=a.size.height;t&&(r=0,d=Math.round(t.y),"top"==t.snappedEdge&&(r=Math.round(t.y)-a.position.top,a.position.top=parseInt(Math.round(t.y)),a.size.height-=r,n.css("top",Math.round(t.y)),n.height(function(e,t){return a.size.height})),"bottom"==t.snappedEdge&&(a.size.height=d-a.position.top+1,n.height(function(e,t){return a.size.height})),s&&(i||"nw"!==o&&"sw"!==o||(l=a.size.height-x,n.css("left",a.position.left-l)),n.width(function(){return a.size.height})),markAadjacentElement(t,snappedIdH),$guideH.addClass("visible").css("transform","translateY("+(Math.round(t.y)+$canvas.offset().top+$container.scrollTop()-42)+"px)").show()),i&&("left"==i.snappedEdge&&(deltaW=Math.round(i.x)-a.position.left,a.position.left=Math.round(i.x),a.size.width-=deltaW,n.css("left",Math.round(i.x)),n.width(function(e,t){return a.size.width})),"right"==i.snappedEdge&&(a.size.width=Math.round(i.x)-a.position.left+1,n.width(function(e,t){return a.size.width})),s&&(t||"ne"!==o&&"nw"!==o||(c=a.size.width-y,n.css("top",a.position.top-c)),n.height(function(){return a.size.width})),$guideV.addClass("visible").css("transform","translateX("+(Math.round(i.x)+$canvas.offset().left+$container.scrollLeft())+"px)").show(),markAadjacentElement(i,snappedIdV)),0<gridsize&&appSettings.snapToGrid&&!e.altKey&&(p=a.position.left,h=a.position.top,g=a.size.width,u=a.size.height,f=a.position.left+g,v=a.position.top+u,snappedleft=Math.round(p/gridsize)*gridsize,snappedright=Math.round(f/gridsize)*gridsize,snappedtop=Math.round(h/gridsize)*gridsize,snappedbottom=Math.round(v/gridsize)*gridsize,Math.abs(snappedleft-a.position.left),Math.abs(snappedright-a.position.left-g),Math.abs(snappedtop-a.position.top),Math.abs(snappedbottom-a.position.top-u),"se"==o&&(a.size.width=snappedright-p+1,a.size.height=snappedbottom-h+1),"e"==o&&(a.size.width=snappedright-p+1),"s"==o&&(a.size.height=snappedbottom-h+1),"w"==o&&(a.size.width=f-snappedleft,a.position.left=snappedleft),"n"==o&&(a.size.height=v-snappedtop,a.position.top=snappedtop),"nw"==o&&(a.size.height=v-snappedtop,a.position.top=snappedtop,a.size.width=f-snappedleft,a.position.left=snappedleft),"ne"==o&&(a.size.height=v-snappedtop,a.position.top=snappedtop,a.size.width=snappedright-p+1),"sw"==o&&(a.size.width=f-snappedleft,a.position.left=snappedleft,a.size.height=snappedbottom-h+1)),showWireDim({w:parseInt(a.size.width+2*k-1,10),h:parseInt(a.size.height+2*k-1,10),x:parseInt(a.position.left,10),y:parseInt(a.position.top,10)}),$(this).has(".textnew").length&&(a.size.height=$(this).find(".textme").height()-2),$(this).hasClass("btn")&&$(this).find(".textme").css({width:a.size.width-2*k,height:a.size.height-2*k}),$(this).hasClass("svginside")&&(m=a.size.width,$(".ui-resizable-resizing svg ").css("width",m),w=a.size.height,$(".ui-resizable-resizing svg ").css("height",w)),$(this).find(".hasSVG").length&&(m=$(this).width(),w=$(this).height(),b=parseInt($(this).find(".line2").attr("stroke-width")),$(this).find(".line1").attr("x2",m-2*b),$(this).find(".line1").attr("y1",w-2*b),$(this).find(".line2").attr("x2",m-2*b),$(this).find(".line2").attr("y2",w-2*b),$(this).find("svg").attr("height",w-2*b),$(this).find("svg").attr("width",m-2*b))},stop:function(e,t){var a,i,s=$canvas.data("guideH"),n=$canvas.data("guideV");s&&t.position.top!==$(this).position().top&&$(this).css("top",t.position.top),$guidesHV.hide(),!$(this).find(".wirejr").hasClass("w-icon")||n||s||($(this).width(Math.round(t.size.width)),$(this).height(Math.round(t.size.height))),computeGuides($(this)),$(this).data("resizing",!1),draggingInProgress=resizingInProgress=!1,$canvaswrap.removeClass("draggingInProgress"),$("#guide-v , #guide-h").hide(),$(this).addClass("selected"),computeGuides($(this)),$(this).data("resizing",!1),$(".ui-resizable-resizing").hasClass("svginside")&&(a=t.size.width,$(".ui-resizable-resizing svg ").css("width",a),i=t.size.height,$(".ui-resizable-resizing svg ").css("height",i)),$(this).radiusable("positionHandles"),removeMarkedElemBorder()},snap:" .col ",handles:"all"}),e.each(function(){$(this).has(".textnew").length&&$(this).find(".ui-resizable-ne, .ui-resizable-nw, .ui-resizable-sw, .ui-resizable-se, .ui-resizable-n, .ui-resizable-s").remove()}),$(".grouped").length&&$(".grouped").find(".ui-resizable-handle").remove()}modernizeWire(),$(".ok").click(editableTextBlurred),$canvas.delegate(".textme","editThisText",function(e){$(this).parents(".masterpage.master-on").length||edittext(e,this,$(this).parents(".wire").hasClass("btn"))}),$.widget("ui.boxer",$.extend({},$.ui.mouse,{_init:function(){this.element.addClass("ui-boxer"),this.dragged=!1,this._mouseInit(),this.helper=$(document.createElement("div")).css({background:"rgba(31, 51, 71, 0.4)"}).addClass("ui-boxer-helper")},destroy:function(){return this.element.removeClass("ui-boxer ui-boxer-disabled").removeData("boxer").unbind(".boxer"),this._mouseDestroy(),this},_mouseStart:function(e){var t,a;wirepanel.hide(),quill&&((t=$(e.target)).hasClass("textme")&&$body.hasClass("edit-btn")&&(a=!0),blurRTE(),a?(render_edit_menu(),positionwirepanel(t.parents(".wire"))):wirepanel.hide()),($(e.target).hasClass("overlay")||$("body").hasClass("slide-right")||$("body").hasClass("slide-down")||$("body").hasClass("slide-left")||$("body").hasClass("show-device-skin-popup")||$("body").hasClass("top-dd-active")||$("body").hasClass("show-icon-picker"))&&feuxOverlayClicked(),app.activepage.masterpageSelected&&deselectMaster(),$canvaswrap.addClass("draggingInProgress"),draggingInProgress=!0,appSettings.snapToGuides&&!e.altKey&&(draggingInProgress={}),e.ctrlKey||e.shiftKey||e.metaKey||a||(deselectAll($(e.target).hasClass("wirejr")),controlIconsHide()),$(e.target).hasClass("wire")||$(e.target).hasClass("wirejr")||showWireDim(!1),$("#canvas .latestwire").removeClass("latestwire"),$(".blank").remove();var i,s,n,o,r,d,l=this;this.opos=(i=e,o=$canvas.data("guideV"),r=$canvas.data("guideH"),o?(s=roundHalf(o.x+$canvas.offset().left),l.origSnapX=o.x,$canvas.data("guideV",!1)):s=i.pageX,r?(n=roundHalf(r.y+$canvas.offset().top),l.origSnapY=r.y,$canvas.data("guideH",!1)):n=i.pageY,appSettings.snapToGrid&&0<gridsize&&!i.altKey&&(s=$canvas.offset().left+Math.round((s-$canvas.offset().left)/gridsize)*gridsize,n=$canvas.offset().top+Math.round((n-$canvas.offset().top)/gridsize)*gridsize),{x:s,y:n}),this.options.disabled||(d=this.options,this._trigger("start",e),$(d.appendTo).append(this.helper),this.helper.css({"z-index":99,position:"absolute",left:this.opos.x,top:this.opos.y,width:0,height:0}))},_mouseDrag:function(e){$canvas.data("drawing-in-progress",!0),draggingInProgress={};this.options;var t,a,i=this.opos.x,s=this.opos.y;this.selecting||!appSettings.snapToGuides||e.altKey||(t=$canvas.offset(),a={x:parseInt(e.pageX-t.left),y:parseInt(e.pageY-t.top)},this.x2corr||this.y2corr||$.extend(draggingInProgress,{right:a.x,bottom:a.y}),this.x2corr&&!this.y2corr&&(delete draggingInProgress.right,$.extend(draggingInProgress,{left:a.x,bottom:a.y})),!this.x2corr&&this.y2corr&&(delete draggingInProgress.bottom,$.extend(draggingInProgress,{top:a.y,right:a.x})));if(this.dragged=!0,!this.options.disabled){var n,o,r,d,l=$canvas.data("guideH"),c=$canvas.data("guideV");return l&&!this.selecting?(y2=parseInt(l.y*zoomfactor+$canvas.offset().top),$guideH.addClass("visible").css("transform","translateY("+(l.y+$canvas.offset().top+$container.scrollTop()-42)+"px)").show(),markAadjacentElement(l,snappedIdH)):y2=e.pageY,c&&!this.selecting?(x2=parseInt(c.x*zoomfactor+$canvas.offset().left),$guideV.addClass("visible").css("transform","translateX("+(c.x+$canvas.offset().left+$container.scrollLeft())+"px)").show(),markAadjacentElement(c,snappedIdV)):x2=e.pageX,appSettings.snapToGrid&&0<gridsize&&!this.selecting&&!e.altKey&&(x2=$canvas.offset().left+Math.round((x2-$canvas.offset().left)/gridsize)*gridsize,y2=$canvas.offset().top+Math.round((y2-$canvas.offset().top)/gridsize)*gridsize),3<i-x2&&3<s-y2?(this.helper.addClass("selecting"),$guidesHV.hide(),this.selecting=!0,$canvas.data("guideH",!1).data("guideV",!1)):(this.helper.removeClass("selecting"),this.selecting=!1),this.lastx1=i,this.lastx2=x2,this.lasty1=s,this.lasty2=y2,i>x2?(n=x2,x2=i,i=n,this.x2corr=!0):this.x2corr=!1,s>y2?(o=y2,y2=s,s=o,this.y2corr=!0):this.y2corr=!1,this.x1=i,this.y1=s,d=c&&!this.x2corr||this.origSnapX?roundHalf(x2-i)+zoomfactor:roundHalf(x2-i),r=e.shiftKey?d:l&&!this.y2corr||this.origSnapY?roundHalf(y2-s)+zoomfactor:roundHalf(y2-s),this.helper.css({left:i,top:s,width:d,height:r}),showWireDim({x:i,y:s,w:d,h:r},!0),this._trigger("drag",e),!1}},_mouseStop:function(e){$canvas.data("drawing-in-progress",!1),$canvaswrap.removeClass("draggingInProgress");var t,a,i=$canvas.data("guideH"),s=$canvas.data("guideV");this.lastx1>this.lastx2&&(t=this.lastx2,(a=this.origSnapX)||this.opos.x,this.x2=this.x1,this.x1=t,s&&(this.origSnapX=s.x,s=!1),a&&(s.x=a,this.origSnapX=t/zoomfactor-$canvas.offset().left/zoomfactor)),this.lasty1>this.lasty2&&(t=this.lasty2,(a=this.origSnapY)||this.opos.y,this.y2=this.y1,this.y1=t,i&&(this.origSnapY=i.y,i=!1),a&&(i.y=a,this.origSnapY=t/zoomfactor-$canvas.offset().top/zoomfactor));this.dragged=!1;this.options;var n=this.x1,o=this.y1,r=$canvaswrap.offset();activepage.find(".wirejr, .grouped").not(".groupmember").length?activepage.find(".wirejr, .grouped").not(".groupmember").each(function(){var e=parseInt($(this).css("zIndex"),10);index_highest<e&&(index_highest=e)}):index_highest=1;var d=n-r.left,l=o-r.top;clonewidth=this.helper.width(),cloneheight=this.helper.height(),cwidth<clonewidth&&(clonewidth=cwidth);var c={left:this.origSnapX?Math.round(this.origSnapX):d,top:this.origSnapY?Math.round(this.origSnapY):l},p=(s&&s.parent,this.helper.clone().css({left:c.left,top:c.top,width:s?parseInt(s.x-c.left+1):parseInt(clonewidth/zoomfactor),height:i?parseInt(i.y-c.top+1):parseInt(cloneheight/zoomfactor),"z-index":index_highest+1}).removeClass("ui-boxer-helper").appendTo(activepage).addClass("brandnew blank"));return this.origSnapX=!1,i=s=this.origSnapY=!1,this._trigger("stop",e,{box:p}),this.helper.removeClass("selecting").remove(),removeMarkedElemBorder(),$canvas.removeAttr("data-snap-mark"),!1}})),$.extend($.ui.boxer,{defaults:$.extend({},$.ui.mouse.defaults,{appendTo:"body",distance:0})}),activepage=$(".page").length?$(".page.active:not(.master-on)").length?$(".page.active:not(.master-on)").last():$(".page:visible").length?$(".page:visible"):$(".page").first():$("#canvas"),previewMode||useboxer(),wirepanel.on("click",".icon",function(){var e=$(this);type=e.attr("elementtype"),"w-icon"!=type?$canvas.find(".brandnew").length&&prepareWire(type):renderIconPicker()}),$canvas.on("mouseenter",".wire",function(){var t,e,a;appSettings.drawOnTop||(e=(t=$(this)).parent(),t.is(":data(draggable)")||t.is(".multidrag")||t.is(".editingtext")||previewMode||e.hasClass("master-on")||makeDrag(t),hideGuidesAndMarkers(),t.is(":data(draggable)")&&(a=!(isover=!0),$(document).bind("keydown",function(e){a||(a=!0,(e.shiftKey||e.metaKey)&&1==isover&&t.draggable("disable"))})))}).on("mouseleave",".wire",function(e){var t;appSettings.drawOnTop||(isover=!1,$(document).unbind("keydown"),(t=$(this)).hasClass("ui-draggable-disabled")&&!t.hasClass("btn")&&t.draggable("enable"))}),$canvas.on("mousedown",".wire.ui-draggable",function(e){var s,n;e.altKey&&(activepage.data("altdrag",!0),1==(s=activepage.find(".selected")).length&&(n=s.draggable("option","helper"),s.draggable("option","helper","clone").removeClass("selected").addClass("altdrag")),n&&$canvas.droppable({drop:function(e,t){var a=$(t.helper).clone().removeClass("ui-draggable-dragging, ui-resizable");a.appendTo(activepage).addClass("selected").removeClass("altdrag").find(".ui-resizable-handle, .ui-border-radius-handle").remove();var i=[];a.each(function(e){var t="w"+(new Date).getTime()+e;$(this).draggable("destroy").resizable("destroy").radiusable("destroy").attr("id",t),i[e]=t}),historystate.shift(),saveState("",i),computeGuides(a),makeDrag(a),$canvas.droppable("destroy"),s.draggable("option","helper",n),activepage.data("altdrag",!1)}}))});var copied,isover=!1;function MakeCanvasDrag(){$("#canvas-wrap").resizable("destroy").draggable("destroy"),previewMode||$("#canvas-wrap").resizable({minWidth:320,minHeight:320,start:function(e,t){wirepanel.hide(),supercanvas.width("20000px");$("#canvas").height();$(this).data("pos-l",$(this).css("left")),$("#canvas").css("width","100%"),$("#canvas").css("height","100%")},resize:function(e,t){e.stopPropagation(),cwidth=t.size.width,$(".canvassize").html("<b>canvas</b>: "+parseInt(t.size.width,10)+"/"+parseInt(t.size.height,10)+"px")},stop:function(e,t){var a;draggingInProgress=resizingInProgress=!1,cwidth=t.size.width,$canvaswrap.hasClass("mobile-landscape")&&(cwidth=480),activepage.attr({"data-page-width":t.size.width,"data-page-height":t.size.height}),a=t.size.width+100<$(window).width()?$(window).width():t.size.width+450,supercanvas.css({width:a+"px",height:t.size.height+750+"px"}),t.size.height+750<$container.height()&&$container.scrollTop(t.size.height+750-$container.height()),t.size.height+450<$container.height()&&$container.scrollLeft(t.size.width+450-$container.width()),$container.perfectScrollbar("update"),$(this).center(),updateCanvasInput()},handles:"s , e"}).draggable({handle:"#browser",cursor:"move",containment:".supercanvas",start:function(){$body.removeClass("slide-right slide-down slide-left show-settings-colorpicker")},stop:function(e){parseInt($(this).css("top"),10)<32&&$(this).transition({top:"33px"}),offset_c=$("#canvas").offset()}})}function delnow(){var e=$canvas.find(".selected").not(".locked");saveState(e),removeGuides(e),e.remove(),showWireDim(!1),selectedHovered=!1}function positionwirepanel(e,t,a){$guideV.hide(),$guideH.hide(),wirepanel.css("transform","none").removeClass("rich-text-active").find(".full-item").hide(),t&&wirepanel.addClass("rich-text");$canvaswrap.offset();var i=e||activepage.find(".selected");$canvas.find(".brandnew").length&&!e&&(i=$canvas.find(".brandnew"));i.height();var s,n,o,r,d,l=i.width(),c=i.position();c&&(s=c.top+$canvaswrap.position().top-57+parseInt($canvaswrap.css("margin-top"),10),wirepanel.css({top:0,left:0,width:"auto"}).show(),n=wirepanel[0].clientWidth,wirepanel.hide(),o=$(window).width(),(r=c.left+l/2+$canvaswrap.position().left-n/2)+supercanvas.offset().left<=0&&(r=23-supercanvas.offset().left),(s-$container.scrollTop()-20<=0||t&&s<=80)&&(0==$container.scrollTop()?s=10:(d=i.position().top,$container.scrollTop(d+$canvaswrap.position().top-(t?120:60)))),r+n+supercanvas.offset().left+20>o&&(r=o-n-supercanvas.offset().left-20),wirepanel.css({top:s,left:r,width:n+"px",transform:"translate(0,0)",display:"block"}))}function editme(e,t,a){var i,s=e;if(!multipaged||s.parents(".page").attr("id")===app.activepage.id)if(void 0!==t&&($(t.target).hasClass("wirejr")&&$(t.target).parents(".empty-btn").length||$(t.target).parents(".ql-editor").length&&$(t.target).parents(".btn").length)){if(t.stopPropagation(),(i=$(t.target)).parent().hasClass("editingtext"))return;var n=i.parents(".wire").find(".textme");1===activepage.find(".selected").length?n.trigger("editThisText"):(render_edit_menu(),positionwirepanel())}else if(!s.is(".hastext")||s.is(".edited-text")||activepage.find("#sel-text").length||s.is(".locked")||s.parents(".master-on").length||$canvas.hasClass("preview")||previewMode){if(s.is(".locked")||s.is(".edited-text"))return!1;s.length&&!s.is(".grouped")&&(render_edit_menu(),positionwirepanel())}else{t&&t.stopPropagation(),s.addClass("selected"),render_edit_menu(!0),(i=s.find(".textme")).trigger("editThisText")}}function copynow(){var e;(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")).addClass("copying").resizable("destroy").draggable("destroy").radiusable("destroy");var o="",r=0,d=0,l=1e8,c=1e8;e.each(function(e){var t=$(this),a=t.position().top+t.height(),i=t.position().top,s=t.position().left+t.width(),n=t.position().left;r<a&&(r=a),d<s&&(d=s),n<c&&(c=n),i<l&&(l=i),o+=t.outerHTML()});var t={data:o,filename:filename,parent:activepage.attr("id"),outerWidth:Math.round(d-c),outerHeight:Math.round(r-l),outerTop:Math.round(l),outerLeft:Math.round(c)};localStorage.setItem("clipboard",JSON.stringify(t)),e.removeClass("selected , copying"),pasteIndex=1}function cutnow(){var e;e=multipaged?$("#canvas .page:visible .selected"):$("#canvas .selected"),copynow(),saveState(),e.remove()}MakeCanvasDrag(),$("#edit").click(function(){$("#icons").show().siblings().hide(),$('.icon[elementtype="headlinetxt"]').hide(),positionwirepanel()}),posTopArray=[],posLeftArray=[],$("#copy").click(function(){copynow()}),$("#cut").click(function(){cutnow()}),key("ctrl+c, command+c",function(){activepage.find("[contenteditable=true]").length||copynow()}),key("ctrl+x, command+x",function(){activepage.find("[contenteditable=true]").length||cutnow()}),key("backspace,del",function(e){if(app.activepage.masterpageSelected)app.removeMasterFromPage(app.activepage.masterpageSelected);else if(!activepage.find("[contenteditable=true]").length){if($(e.target).is("input"))return!1;var t=$(document.activeElement).hasClass("editingtext"),a=$(document.activeElement).hasClass("editor-form-element"),i=$(document.activeElement).hasClass("input"),s=$(".appriseInner").length,n=$ajaxlogin.is(":visible"),o=$canvas.find(".selected").length,r=$(".blank").length;if(!(t||a||i||s||o))return!1;!o||t||i||a||s||n||r||(e.preventDefault(),delnow())}}),$("#paste").click(function(){paste()}),key("ctrl+v, command+v",function(){activepage.find("[contenteditable=true]").length||paste()}),key("ctrl+shift+v, command+shift+v",function(){activepage.find("[contenteditable=true]").length||paste(!0)});var pasteIndex=1;function paste(n){if(activepage.find("[contenteditable=true]").length)return!1;deselectAll();var e=JSON.parse(localStorage.getItem("clipboard"));if(!e)return!1;var t=$("<div/>").html(e.data).contents(),o=[],r=1;activepage.find(".wirejr , .grouped").not(".aa, .groupmember").each(function(){var e=parseInt($(this).css("zIndex"),10);r<e&&(r=e)}),t.sort(function(e,t){return(e=parseInt($(e).find(".wirejr").not(".groupmember").css("zIndex"),10))-(t=parseInt($(t).find(".wirejr").not(".groupmember").css("zIndex"),10))});var d=activepage.attr("id")==e.parent&&filename==e.filename,a=e.outerTop||100,i=e.outerLeft||100,l=$(window).height()/2-$canvaswrap.offset().top-a-e.outerHeight/2,c=$(window).width()/2-$canvaswrap.offset().left-i-e.outerWidth/2;t.each(function(e){var t="w"+(new Date).getTime()+e,a=$(this);a.hasClass("groupmember")||(o[e]=t);var i=Math.round(parseInt(a.css("top"),10)+(n?0:l)),s=Math.round(parseInt(a.css("left"),10)+(n?0:c));a.attr("id",t).removeClass("copying"),a.is(".grouped")?a.css({"z-index":r+pasteIndex+e}):a.find(".wirejr").not(".groupmember .wirejr").css({"z-index":r+pasteIndex+e}),a.css({top:i+"px",left:s+"px"}),d&&!n&&(0<gridsize&&appSettings.snapToGrid?a.css({top:Math.round((i+gridsize*pasteIndex)/gridsize)*gridsize+"px",left:Math.round((s+gridsize*pasteIndex)/gridsize)*gridsize+"px"}):a.css({top:i+10*pasteIndex+"px",left:s+10*pasteIndex+"px"})),a.is(".grouped")&&$.each(a.find(".wire.groupmember"),function(e){var t="w"+(new Date).getTime()+e;$(this).attr("id",t)})}),activepage.append(t),computeGuides(t),makeDrag(t),saveState("",o,null,null,null,!0),pasteIndex+=1}function changeBorderWidth(e){var t;quill&&blurRTE(),saveState(),(t=$(".selected").has(".wirejr").length?activepage.find(".selected").not(".locked").find(".wirejr"):$canvas.find(".selected").not(".locked")).css("box-sizing","content-box");var a=parseInt(t.css("borderLeftWidth"),10),i=e,s=t.width()-2*parseInt(i,10)+2*a,n=t.height()-2*parseInt(i,10)+2*a;t.css({width:s+"px",height:n+"px","border-width":e}),t.css({width:s+"px",height:n+"px","border-width":i+"px"}),t.hasClass("svginside")&&$(".selected svg *").css("stroke-width",i),t.hasClass("hasSVG")&&($(".selected svg line").attr("stroke-width",i),$(".selected svg .line1").attr({y1:n,x2:s}),$(".selected svg .line2").attr({y2:n,x2:s}),$(".selected svg").attr({height:n,width:s})),t.parent().hasClass("btn")&&t.find(".textme").css({height:t.outerHeight()-2*e+"px",width:t.outerWidth()-2*e+"px"}),showWireDim({w:t.outerWidth()-1,h:t.outerWidth()-1})}function changeBackgroundColor(e){quill&&blurRTE(),saveState();var t,a=e;(t=activepage.find(".selected").has(".wirejr").length?activepage.find(".selected").not(".locked").find(".wirejr"):$canvas.find(".selected").not(".locked"))&&(t.hasClass("w-icon")?t.css("color",a):t.css("background-color",a),t.hasClass("headline")&&t.find("span").css("background-color",a),t.hasClass("paragraph")&&t.find("span").css("background-color",a),t.hasClass("list")&&(t.find("span").css({"background-color":a,color:a}),t.attr("data-color",a))),t.hasClass("svginside")&&$(".selected .image *").css("background-color",a)}function changeBorderColor(e){var t;quill&&blurRTE(),saveState(),t=$(".selected").has(".wirejr").length?activepage.find(".selected").not(".locked").find(".wirejr"):$canvas.find(".selected").not(".locked"),current_brcolor=e,t.css("border-color",current_brcolor),t.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),t.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor),t.hasClass("combobox2")&&t.css("color",current_brcolor)}function bring_to_front(){var e=activepage.find(".selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);index_highest<e&&(index_highest=e)}),e.each(function(){($(this).is(".grouped")?$(this).find(" > div"):$(this).find(".wirejr")).css("z-index",index_highest+1)})}function send_to_back(){var e=activepage.find(".selected").not(".locked");saveState(e),activepage.find(".wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10);$(this).css("z-index",e+1)}),e.each(function(){($(this).is(".grouped")?$(this).find(" > div"):$(this).find(".wirejr")).css("z-index",1)})}function send_backward(){var e=activepage.find(".selected").not(".locked");saveState(e),e.each(function(){var e;e=$(this).is(".grouped")?$(this).find(" > div"):$(this).find(".wirejr");var t=parseInt(e.css("zIndex"),10);t<=0&&(t=1),e.css("z-index",t-1)})}function bring_forward(){var e=activepage.find(".selected").not(".locked");saveState(e),e.each(function(){var e;e=$(this).is(".grouped")?$(this).find(" > div"):$(this).find(".wirejr");var t=parseInt(e.css("zIndex"),10);e.css("z-index",t+1)})}function computeGuidesForElement(e){var t,a,i,s=$(e);return s.is(".col")?(t=s.position(),ww=$("#canvas").width(),t.left+=.01*ww):t=s.position(),i=s.is(".col")?(a=s.width(),s.height()-1):(a=s.outerWidth()-1,s.outerHeight()-1),[{type:"h",x:Math.round(t.left),y:Math.round(t.top)},{type:"h",x:Math.round(t.left),y:Math.round(t.top)+i},{type:"v",x:Math.round(t.left),y:Math.round(t.top)},{type:"v",x:Math.round(t.left)+a,y:Math.round(t.top)}]}function computeColForElement(e){var t=$(e),a=t.position();ww=$canvas.width(),a.left+=.01*ww;var i=t.width();return[Math.round(a.left+1),Math.round(a.left+i)]}function aspect_ratio(e){var t=e.width()/e.height();.3<=t&&t<=4&&($(".icon.rect").show(),$(".icon:not(.rect)").hide()),t<.3&&($(".icon.vertical").show(),$(".icon:not(.vertical)").hide()),4<t&&($(".icon.horizontal").show(),$(".icon:not(.horizontal)").hide()),$("#annotate").hide(),$("#textinput").addClass("lasticon")}$body.on("click",".colorpicker",function(e){changeBackgroundColor($(this).css("background-color"))}),$(".strokeweight").click(function(){changeBorderWidth($(this).attr("stroke"))}),$.fn.getId=function(){if($(this).attr("id"))return $(this).attr("id");var e="w"+(new Date).getTime();return $(this).attr("id",e),e},$(".brcolor").click(function(){var e;quill&&blurRTE(),saveState(),e=$(".selected").has(".wirejr").length?activepage.find(".selected").not(".locked").find(".wirejr"):$canvas.find(".selected").not(".locked"),current_brcolor=$(this).css("border-left-color"),e.css("border-color",current_brcolor),e.hasClass("svginside")&&$(".selected svg *").css("stroke",current_brcolor),e.hasClass("hasSVG")&&$(".selected svg line").attr("stroke",current_brcolor),(e.hasClass("combobox2")||e.hasClass("scrollh2")||e.hasClass("scrollv")|e.hasClass("slider2"))&&e.css("color",current_brcolor)}),$("#front").click(function(){bring_to_front()}),$("#back").click(function(){send_to_back()}),$("#backward").click(function(){send_backward()}),$("#forward").click(function(){bring_forward()});var $showbg=$("#wirepanel #show-bg"),$strokes=$("#wirepanel #strokes"),$showborderbg=$("#wirepanel #show-border , #show-bg"),$colorpickers=$("#wirepanel #colorpickers"),$bordercolors=$("#wirepanel #bordercolors"),$edittxt=$("#wirepanel #edittxt"),$textalsz=$("#wirepanel #textalign , #wirepanel #textsize");function render_edit_menu(e){e||wirepanel.removeClass("rich-text rich-text-active"),$("#icons").hide().siblings().not("#lock , #unlock , #linklist").show(),$("#linklist").hide();var t,a,i=activepage.find(".selected");t=i.has(".wirejr").length?i.find(".wirejr"):i,$showbg.hide(),$("#wp-icon-picker").hide(),wirepanel.show(),t.hasClass("paragraph")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),$edittxt.hide()),t.hasClass("list")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$("#textsize").show(),$("#textalign").hide(),$edittxt.hide()),e||t.hasClass("paragraph")||t.hasClass("list")||($("#show-border").show(),$("#brind-back-front").show(),$colorpickers.show(),$bordercolors.hide(),$strokes.show(),$textalsz.hide()),t.hasClass("headline")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.show(),wirepanel.hide()),t.hasClass("w-icon")&&($strokes.hide(),$showborderbg.hide(),$colorpickers.show(),$bordercolors.hide(),$textalsz.hide(),$("#wp-icon-picker").show().find("use").attr("xlink:href",t.find("use").attr("xlink:href"))),(t.hasClass("paragraph")||t.hasClass("list")||t.hasClass("headline"))&&(a=t.hasClass("headline")?$.inArray(i.find('span:not(:has("*"))').css("fontSize"),["14px","22px","28px"]):t.hasClass("paragraph")?$.inArray(i.find(".txtcont").css("fontSize"),["7px","10px","18px"]):$.inArray(i.find('span:not(:has("*"))').css("fontSize"),["7px","10px","18px"]),$("#feux-font-size-slider").slider("option","value",a))}function setFeuxFonsSize(e){if(saveState(),sizes={0:[{fontsize:"7px",lineheight:"13px"},{fontsize:"14px",lineheight:"14px",marginbottom:"2px"}],1:[{fontsize:"10px",lineheight:"20px"},{fontsize:"22px",lineheight:"22px",marginbottom:"6px"}],2:[{fontsize:"18px",lineheight:"36px"},{fontsize:"28px",lineheight:"28px",marginbottom:"8px"}]},void 0===e)return!1;activepage.find(".selected.paragraph span , .selected .paragraph span").css({"font-size":sizes[e][0].fontsize,"line-height":sizes[e][0].lineheight}),activepage.find(".selected.list span ul li,  .selected .list span ul li ").css({"font-size":sizes[e][0].fontsize,"line-height":sizes[e][0].lineheight}),activepage.find(".selected .headline").find(".headtext span ").css({"font-size":sizes[e][1].fontsize,"line-height":sizes[e][1].lineheight,"margin-bottom":sizes[e][1].marginbottom})}$("#show-bg").click(function(){$("#colorpickers").show(),$("#bordercolors").hide(),$("#show-border").show(),$("#show-bg").hide()}),$("#show-border").click(function(){$("#bordercolors").show(),$("#colorpickers").hide(),$("#show-border").hide(),$("#show-bg").show()}),$("#alignleft").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","left")}),$("#aligncenter").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","center")}),$("#alignright").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","right")}),$("#alignjustify").click(function(){saveState(),activepage.find(".selected .headline span , .selected .paragraph span").css("text-align","justify")}),$("#font-m").click(function(){saveState(),activepage.find(".selected .paragraph span").css({"font-size":"10px","line-height":"20px"}),activepage.find(".selected .list span ul li span").css({"font-size":"10px","line-height":"20px"}),activepage.find(".selected .headline").find(".headtext span").css({"font-size":"22px","line-height":"22px","margin-bottom":"6px"})}),$("#font-l").click(function(){var e;saveState(),activepage.find(".selected .paragraph span").css({"font-size":"18px","line-height":"36px"}),activepage.find(".selected .list span ul li span").css({"font-size":"18px","line-height":"36px"}),activepage.find(".selected.headlinetxt .editable .content-wrapper").css({"font-size":"28px","line-height":"28px"}),activepage.find("[contenteditable=true]").length&&((e=activepage.find("[contenteditable=true]")).css({"font-size":"28px"}),e.parent().css("height",e.height()),e.focus()),activepage.find(" .selected .headline").find(".headtext span ").css({"font-size":"28px","line-height":"28px","margin-bottom":"8px"})}),jQuery.fn.center=function(e){var e=this.parent(),t=Math.round(($(e).width()-this.outerWidth())/2);return t<0&&(t=10),this.css({left:t+"px","margin-left":"0"}),this};var annotationhtml="<span class=annotbox><div class='editme thelatest'></div><button class=ok><i class=icon-ok></i> ok</button></span><div class=closeannot></div>",texthtml="<span class='text'><div class='textme'></div></span>",paragraph="<span class=txtcont><span>Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iise mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.</span></span>",paragraphtext="Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel. Lorem ipsum dolor sit amet, et delectus accommodare his, consul copiosae legendos at vix, ad putent delectus delicata usu. Vidit dissentiet eos cu, eum an brute copiosae hendrerit. Eos erant dolorum an. Per facer affert ut. Mei iisque mentitum moderatius cu. Sit munere facilis accusam eu, dicat falli consulatu at vis.</br>Te facilisis mnesarchum qui, posse omnium mediocritatem est cu. Modus argumentum ne qui, tation efficiendi in eos. Ei mea falli legere efficiantur, et tollit aliquip debitis mei. No deserunt mediocritatem mel.",list="<span class='listcont'><ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul></span>",listhtml="<ul><li><span>Lorem ipsum dolorsit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor dapibus neque.</span></li><li><span>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</span></li><li><span>Aliquam tincidunt mauris eu risus.</span></li><li><span>Vestibulum auctor neque.</span></li></ul>",headtxt="<span class='headtext'><span>Lorem</span> <span>ipsum</span> <span>dolor</span> <span>sitammet</span> <span>quam</span> <span>Lorem</span> <span>ipsumdolor</span> <span>sitammet</span> <span>quam</span></span>",img="<svg id='imgwire' version='1.1' baseProfile='tiny'  xmlns='http://www.w3.org/2000/svg'  width='200px' height='100px' viewBox='0 0 200 100' preserveAspectRatio='none'><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='100' x2='200' y2='0'/><line vector-effect='non-scaling-stroke' fill='none' stroke='#444444' stroke-width='2' x1='0' y1='0' x2='200' y2='100'/></svg>";function getRandomNumber(e){return Math.floor(Math.random()*e)}function getRandomChar(){return"0123456789abcdefghijklmnopqurstuvwxyzABCDEFGHIJKLMNOPQURSTUVWXYZ".substr(getRandomNumber(62),1)}function randomID(e){for(var t="",a=0;a<e;a++)t+=getRandomChar();return t}function demo0(){$("#canvas").append("<div id='demo'><div class='demoinfo'>Click & drag to draw</div><div id='demobox' ></div><div id='democursor'><i class='icon-cursor'></i></div><div id='demopanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div id='demoeditpanel'><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>"),$("#demobox").css({width:"0",height:"0"}).removeAttr("class"),$(".demoinfo").text("Click & drag to draw"),$("#demo").fadeIn("slow",demo1)}function demo1(){$("#democursor").animate({top:"40px",left:"20px"},1500,demo1a)}function demo1a(){$("#democursor").addClass("drag"),demo2()}function demo2(){$("#demobox").delay(500).animate({width:"240px",height:"160px"},3500),$("#democursor").delay(500).animate({top:"200px",left:"260px"},3500,demo3)}function demo3(){$("#democursor").removeClass("drag"),$("#demopanel").delay(500).show(0,demo4)}function demo4(){$(".demoinfo").text("Select stencil"),$("#democursor").delay(800).animate({top:"125px",left:"55px"},1500,demo5)}function demo4a(){demo5()}function demo5(){$("#demobox").addClass("demobox"),$("#democursor").delay(800).animate({top:"125px",left:"80px"},500,demo5a)}function demo5a(){$("#demobox").addClass("round"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5b)}function demo5b(){$("#demobox").addClass("demoround"),$("#democursor").delay(800).animate({top:"125px",left:"105px"},500,demo5c)}function demo5c(){$("#democursor").addClass("drag"),demo5d()}function demo5d(){$("#demopanel").delay(300).hide(0,demo5e)}function demo5e(){$("#democursor").removeClass("drag"),demo6()}function demo6(){$("#demopanel").delay(1500).hide(0,demo6a)}function demo6a(){$(".demoinfo").text("Doubleclick to edit"),$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6b)}function demo6b(){$("#democursor").removeClass("drag"),demo6c()}function demo6c(){$("#demopanel").delay(200).hide(0,demo6d)}function demo6d(){$("#democursor").addClass("drag"),$("#demopanel").delay(200).hide(0,demo6e)}function demo6e(){$("#democursor").removeClass("drag"),$("#demoeditpanel").delay(400).show(0,demo7)}function demo7(){$("#democursor").delay(800).animate({top:"125px",left:"178px"},500,demo7a)}function demo7a(){$("#demopanel").delay(500).hide(0,demo7b)}function demo7b(){$("#democursor").addClass("drag"),$("#demobox").addClass("grey"),demo7c()}function demo7c(){$("#demoeditpanel").delay(300).hide(0,demo7d)}function demo7d(){$("#democursor").removeClass("drag"),demo8()}function demo8(){$("#demo").delay(1600).hide("slow")}$("#watch-demo").click(function(){$(".panel").is(":visible")||demo0()}),$canvas.find(".aa").length&&$("#hide-annotation").show(),$canvas.find(".aa:hidden").length&&($("#hide-annotation").hide(),$("#show-annotation").show());var delay=function(){var a=0;return function(e,t){clearTimeout(a),a=setTimeout(e,t)}}();function updategrid(e){$("#gridcol").hide();for(var t=0;t<5;t++){var a="#grid-pattern .lineV:eq("+[t]+")";$("#grid-pattern .lineH:eq("+[t]+")").attr({y1:[t+1]*e,y2:[t+1]*e,x2:5*e}),$(a).attr({x1:[t+1]*e,x2:[t+1]*e,y2:5*e}),$(".svgdot").attr({cx:e-.5,cy:e-.5})}$("#grid-pattern").attr({width:5*e,height:5*e}),$("#dot-pattern").attr({width:e,height:e})}function turngridon(){$("#snap-to-grid").attr("checked")&&("graph"==appSettings.gridType?(gridsize=appSettings.gridSize,$canvaswrap.attr({"data-grid-size":gridsize,"data-grid-show":"true"})):"dots"==$("select#grid-type").val()&&(gridsize=$("#grid-slider").slider("value"),$canvaswrap.attr({"data-grid-size":gridsize,"data-grid-show":"true"})))}$(window).resize(function(e){e.target==window&&delay(function(){$canvaswrap.center()},500)}),$("#grid-slider").slider({min:10,max:50,value:20,slide:function(e,t){$(".grid-size-val").text(t.value)},stop:function(e,t){appSettings.gridSize=t.value,saveSettings(),updategrid(t.value),turngridon()}}),$("#snap-to-grid").change(function(){turngridon(),this.checked?($snaptoguides.attr("checked",!1),appSettings.snapToGuides=!1,appSettings.snapToGrid=!0,$canvaswrap.attr({"data-grid-snap":"true"}),gridsize=$("#grid-slider").slider("value")):(gridsize=0,appSettings.snapToGrid=!1,$canvaswrap.attr({"data-grid-snap":"false"})),saveSettings()}),$canvaswrap.data("savedState",[]),$canvaswrap.data("savedUndo",[]);var historystate=$canvaswrap.data("savedState"),future=$canvaswrap.data("savedUndo");function getDeletedGroupData(e){var a=[];return $.each(e,function(e){var t=$(this);a[e]={html:t.find("div").first().outerHTML(),css:{top:t.css("top"),left:t.css("left"),width:t.css("width"),height:t.css("height")},id:t.attr("id"),orgclass:t.attr("class"),parent:t.parent().attr("id")}}),a}function saveState(e,t,a,i,s,n){var o,r=[];if(void 0===e&&(e=$canvas.find(".selected")),t?r={deleteid:t,pasted:n}:$.each(e,function(e){var t=$(this),a=t.getId();r[e]={html:t.find("div").first().outerHTML(),css:{top:t.css("top"),left:t.css("left"),width:t.css("width"),height:t.css("height"),"z-index":t.css("zIndex")},id:a,orgclass:t.attr("class").replace("multidrag",""),parent:t.parent().attr("id"),unlock:t.hasClass("locked")}}),s)for(var d in s)r[d]=s[d];a?o=future:(o=historystate,i||(future=[],$("#redo").removeClass("inactive"))),o.unshift(r),10<o.length&&o.pop(),$("#undo").hasClass("inactive")&&$("#undo").removeClass("inactive")}function restoreState(e){var t=e?historystate:future;if(0<t.length){var i=t[0];if("parent"in i&&i.parent!==app.activepage.id)return;var s,n,o=$();i.deleteid&&deletePasted(i,e,i.pasted),i.hasOwnProperty("0")&&(delete i.deleteid,$.each(i,function(e){i[e]&&(o=o.add($("#"+i[e].id)))}),$("#"+i[0].id).length&&saveState(o,!1,e,!0),s=!1,n=[],$.each(i,function(e){var t,a;"pasted"!==e&&(i[e]&&i[e].unlock?unlock($("#"+i[e].id)):(t=$("#"+i[e].id)).length&&!t.is(".groupmember")?(t.addClass(i[e].orgclass).resizable("destroy").draggable("destroy").radiusable("destroy").css(i[e].css).html(i[e].html),computeGuides(t),showWireDim(t)):($("<div/>").appendTo($("#"+i[e].parent)).addClass(i[e].orgclass).removeClass("ui-draggable ui-resizable ui-resizable-autohide").html(i[e].html).attr("id",i[e].id).css(i[e].css),a=$("#"+i[e].id),o=o.add($("#"+i[e].id)),n[e]=i[e].id,computeGuides(a),showWireDim(a),s=!0))}),s&&saveState("",n,e,!0),makeDrag(o)),t.shift(),$("#redo").hasClass("inactive")&&$("#redo").removeClass("inactive"),e||t.length||($("#redo").addClass("inactive"),$("#undo").removeClass("inactive")),e&&!t.length&&$("#undo").addClass("inactive")}else $("#undo").addClass("inactive");computeGuides()}function deletePasted(e,t,a){var i=$();$.each(e.deleteid,function(e){$("#"+this).is(".grouped")&&!a?ungroup_elements($("#"+this)):i=i.add($("#"+this))}),saveState(i,!1,t),removeGuides(i),showWireDim(!1),i.remove()}function makeDragNow(){historystate.shift(),activepage=multipaged?$(".page:visible"):$("#canvas")}function saveUndo(){4<future.length&&future.pop()}function handleKeys(e){if(!$ajaxlogin.is(":visible")&&!activepage.find("textarea.editingtext").length){var t;if($canvas.find(".locked.selected").removeClass("selected"),!(t=$canvas.find(".selected").length?$canvas.find(".selected"):$canvas.find(".master-on.ui-draggable")).length)return;var a=1;switch(e.shiftKey&&(e.preventDefault(),a=10),0<gridsize&&(appSettings.snapToGrid||"true"===$canvaswrap.attr("data-grid-snap"))&&!e.altKey&&(a=parseInt(gridsize,10)),pTopArray=[],pLeftArray=[],37!=e.keyCode&&38!=e.keyCode&&39!=e.keyCode&&40!=e.keyCode||e.ctrlKey||(app.activepage.masterpageSelected||saveState(),t.each(function(e){thiscsstop=$(this).css("top"),thiscssleft=$(this).css("left"),pTopArray[e]=parseInt(thiscsstop,10),pLeftArray[e]=parseInt(thiscssleft,10)})),e.preventDefault(),e.keyCode){case 37:t.each(function(e){$(this).css("left",pLeftArray[e]-a)});break;case 38:t.each(function(e){$(this).css("top",pTopArray[e]-a)});break;case 39:t.each(function(e){$(this).css("left",pLeftArray[e]+a)});break;case 40:t.each(function(e){$(this).css("top",pTopArray[e]+a)});break;default:return!0}}computeGuides(t),showWireDim(t.first())}function group_ungroup(){var e;(1===(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")).length&&e.is(".grouped")?ungroup_elements:group_elements)(e)}function group_elements(e){var i,s,n,o,t,a;1<e.length&&(s=i=1e5,o=n=-1,removeGuides(e),e.each(function(){var e=$(this).position(),t=$(this).width(),a=$(this).height();i=i<e.top?i:e.top,s=s<e.left?s:e.left,n=n>e.left+t?n:e.left+t,o=o>e.top+a?o:e.top+a}),activepage.find("> .wire > .wirejr , .grouped").each(function(){var e=parseInt($(this).css("zIndex"),10)||0;(index_highest|=1)<e&&(index_highest=e)}),t=Math.floor(99999*Math.random()),e.draggable("destroy").resizable("destroy").radiusable("destroy").css({position:"absolute"}).removeClass("selected").addClass("groupmember"),e.wrapAll('<div  style="position:relative; top:-'+i+"px; left:-"+s+"px;z-index:"+(index_highest+1)+'"/>'),e.parent().wrap('<div class="grouped wire" id='+t+' style="position:absolute;top:'+i+"px; left:"+s+"px;width:"+(n-s)+"px;height:"+(o-i)+'px;"/>'),e.parent().parent().addClass("selected"),computeGuides(activepage.find(".selected")),makeDrag(a=$("#"+t)),a.resizable("destroy").radiusable("destroy"),saveState("",[t]),$("#group").addClass("pressed"))}function ungroup_elements(e){removeGuides(e),e.draggable("destroy").resizable("destroy").radiusable("destroy");var r=[],t=getDeletedGroupData(e);e.each(function(e){var t=$(this),a=(a=t.find("> div > .wire").clone()).sort(function(e,t){return($(e).is(".grouped")?parseInt($(e).css("zIndex")):parseInt($(e).find(".wirejr").css("zIndex")))-($(t).is(".grouped")?parseInt($(t).css("zIndex")):parseInt($(t).find(".wirejr").css("zIndex")))}),i=t.position(),s=parseInt(t.css("zIndex")),n=t.find("> div").position(),o=[];a.each(function(e){var t=$(this);t.is(".grouped")?t.css("z-index",s):t.find(".wirejr").css("z-index",s),o[e]=t.attr("id"),abspos={top:parseInt(t.css("top")),left:parseInt(t.css("left"))},t.css({top:i.top+(abspos.top+n.top),left:i.left+(abspos.left+n.left)})}),r=r.concat(o),a.removeClass("groupmember").appendTo(activepage),computeGuides(a),$("#group").removeClass("pressed").addClass("inactive"),t.remove()}),saveState("",r,null,null,t)}function alignTop(){var e,t;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")),1==e.length?e.css("top","1px"):(t=1e4,e.each(function(){var e=$(this).position();t=t<e.top?t:e.top}),e.css("top",t+"px")),computeGuides(e)}function alignLeft(){var e,t;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")),1==e.length?e.css("left","1px"):(t=1e4,e.each(function(){var e=$(this).position();t=t<e.left?t:e.left}),e.css("left",t+"px")),computeGuides(e)}function alignRight(){var e,t,a,i,s;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")),1==e.length?(t=$("#canvas").width(),a=e.width(),i=parseInt(e.css("borderWidth"),10)||parseInt(e.css("border-top-width"),10),e.css("left",t-a-2*i+1+"px")):(s=-1,e.each(function(){var e=$(this).position(),t=$(this).width();s=s>e.left+t?s:e.left+t}),e.each(function(){var e=$(this).width();$(this).css("left",s-e+"px")})),computeGuides(e)}function alignBottom(){var e,t,a,i,s;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")),1==e.length?(t=$("#canvas").height(),a=e.height(),i=parseInt(e.css("borderWidth"),10)||parseInt(e.css("border-top-width"),10),e.css("top",t-a-2*i+1+"px")):(s=-1,e.each(function(){var e=$(this).position(),t=$(this).height();s=s>e.top+t?s:e.top+t}),e.each(function(){var e=$(this).height();$(this).css("top",s-e+"px")})),computeGuides(e)}function alignVerCenter(){var e,t,a,i,s;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")),1==e.length?(t=$("#canvas").height(),a=e.height(),e.css("top",t/2-a/2+"px")):(i=-1,s=1e3,e.each(function(){var e=$(this).position(),t=$(this).height();i=i>e.top+t?i:e.top+t,s=s<e.top?s:e.top}),e.each(function(){var e=$(this).height();$(this).css("top",(i+s)/2-e/2+"px")})),computeGuides(e)}function alignHorCenter(){var e,t,a,i,s;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked")),1==e.length?(t=$("#canvas").width(),a=e.width(),e.css("left",t/2-a/2+"px")):(i=-1,s=1e3,e.each(function(){var e=$(this).position(),t=$(this).width();i=i>e.left+t?i:e.left+t,s=s<e.left?s:e.left}),e.each(function(){var e=$(this).width();$(this).css("left",(i+s)/2-e/2+"px")})),computeGuides(e)}function distVer(){var e;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked"));var t=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"top"),maxTop=distrb[0].val+distrb[0].div.height()/2,last=distrb.length-1,maxBottom=distrb[last].val+distrb[last].div.height()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.height();thisdiv.css("top",maxTop+(maxBottom-maxTop)/divide*t-e/2+"px"),t++}),computeGuides(e)}function distHor(){var e;saveState(e=multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked"));var t=0;divide=e.length-1,obj=e,distrb=sortdivs(obj,"left"),maxLeft=distrb[0].val+distrb[0].div.width()/2,last=distrb.length-1,maxRight=distrb[last].val+distrb[last].div.width()/2,$.each(distrb,function(){thisdiv=this.div;var e=thisdiv.width();thisdiv.css("left",maxLeft+(maxRight-maxLeft)/divide*t-e/2+"px"),t++}),computeGuides(e)}function sortdivs(e,t){for(var a=new Array,i=0;i<e.length;i++)pos=e.eq(i).position(),"top"==t?a.push({div:e.eq(i),val:pos.top}):a.push({div:e.eq(i),val:pos.left});return a.sort(function(e,t){return e.val<t.val?-1:e.val>t.val?1:0})}function renderContextMenu(){$.contextMenu({selector:".supercanvas, .wire:not(.editingtext),  .groupmember",build:function(e,t){return{events:{show:function(e){var t=$(this);if(t.parents(".master-on").length||t.hasClass("master-on")||app.activepage.masterpageSelected)return!1;t.is(".wire")&&activepage.find(".selected").length<=1&&!t.is(".selected.locked")&&(deselectAll(),t.is(".groupmember")?selectElem(t.parent()):(selectElem(t),makeDrag(t)))}},items:{Copy:{name:"Copy",callback:function(){copynow()},disabled:function(e){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:" C",shortcut:"Ctrl + C"},Cut:{name:"Cut",callback:function(){cutnow()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:" X",shortcut:"Ctrl + X"},Paste:{name:"Paste",callback:function(){paste()},disabled:function(){return!(null!==localStorage.getItem("clipboard")&&!app.activepage.masterpageSelected)},shortMac:" V",shortcut:"Ctrl + V"},"Paste in place":{name:"Paste in place",callback:function(){paste(!0)},disabled:function(){return!(null!==localStorage.getItem("clipboard")&&!app.activepage.masterpageSelected)},shortMac:"  V",shortcut:"Ctrl + Shift+ V"},Delete:{name:"Delete",callback:function(){delnow()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:"Del",shortcut:"Del"},Edit:{name:"Edit",callback:function(){$canvas.find("div.selected").dblclick()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:"doubleclick",shortcut:"doubleclick"},sep0:"---------",arrange:{name:"Arrange",className:"dd-arrange",disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},items:{"Bring to front":{name:"Bring to front",callback:function(){bring_to_front()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:"",shortcut:"Ctrl + Shift + "},"Bring forward":{name:"Bring forward",callback:function(){bring_forward()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:"",shortcut:"Ctrl + "},"Send to back":{name:"Send to back",callback:function(){send_to_back()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:"",shortcut:"Ctrl + Shift + "},"Send backward":{name:"Send backward",callback:function(){send_backward()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:"",shortcut:"Ctrl + "}}},sep1:"---------",align:{name:"Align",className:"dd-align",disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},items:{1:{name:"Top edges",callback:function(){alignTop()}},2:{name:"Bottom edges",callback:function(){alignBottom()}},3:{name:"Left edges",callback:function(){alignLeft()}},4:{name:"Right edges",callback:function(){alignRight()}},5:{name:"Horizontal centers",callback:function(){alignHorCenter()}},6:{name:"Vertical centers",callback:function(){alignVerCenter()}},7:{name:"Distribute vertically",callback:function(){distVer()}},8:{name:"Distribute horizontally",callback:function(){distHor()}}}},"Lock / Unlock":{name:"Lock / Unlock",callback:function(){lock()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:" L",shortcut:"Ctrl + L"},"Group / Ungroup":{name:function(){return 1<activepage.find(".selected").length?"Group":e.is(".grouped")||e.is(".groupmember")?"Ungroup":"Group/Ungroup"},callback:function(){group_ungroup()},disabled:function(){var e=$(this);return!e.is(".grouped")&&!e.is(".groupmember")&&(!e.is(".wire")||activepage.find(".selected").length<=1)},shortMac:" G",shortcut:"Ctrl + G"},sep2:"---------",Link:{name:"Link",callback:function(){makeLink()},disabled:function(){return!$(this).is(".wire")&&!activepage.find(".selected").length},shortMac:" K",shortcut:"Ctrl + K"}}}}})}key("ctrl+z, command+z",function(e){quill||(e.preventDefault(),restoreState(!0))}),$("#undo").click(function(){quill?quill.getModule("history").undo():restoreState(!0)}),key("ctrl+y, command+y, command+shift+z",function(e){quill||(e.preventDefault(),restoreState(!1))}),$("#redo").click(function(){quill?quill.getModule("history").redo():restoreState(!1)}),sett.bind("click",function(e){wirepanel.hide(),$("body").hasClass("slide-down")?($("body").removeClass("show-device-skin-popup slide-left show-settings-colorpicker slide-right slide-down top-dd-active").toggleClass("slide-left"),sharebar.hide(),sett.toggleClass("pressed"),exportbtn.removeClass("pressed")):($("body").removeClass("show-device-skin-popup show-settings-colorpicker slide-right slide-down top-dd-active"),sharebar.hide(),exportbtn.removeClass("pressed"),$("body").removeClass("slide-right , slide-down"),$("body").toggleClass("slide-left"),$(this).toggleClass("pressed "))}),$("#canvas_w_val").change(function(){changePageSize(parseInt($(this).val(),10),!1),$canvaswrap.center()}),$("#canvas_h_val").change(function(){changePageSize(!1,parseInt($(this).val(),10))}),key("down, alt+down, shift+down",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),key("up, alt+up, shift+up",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),key("left, alt+left, shift+left",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),key("right, alt+right, shift+right",function(e){activepage.find("[contenteditable=true]").length||handleKeys(e)}),$("#group").click(function(){group_ungroup()}),key("ctrl+g, command+g",function(e){e.preventDefault(),group_elements(multipaged?activepage.find(".selected").not(".locked"):$canvas.find(".selected").not(".locked"))}),key("ctrl+shift+g, command+shift+g",function(e){e.preventDefault(),ungroup_elements($("#canvas .selected.grouped"))}),$("#align-top").click(alignTop),$("#align-left").click(alignLeft),$("#align-right").click(alignRight),$("#align-bottom").click(alignBottom),$("#align-center").click(alignVerCenter),$("#align-middle").click(alignHorCenter),$("#dist-v").click(distVer),$("#dist-h").click(distHor),$("#align").click(function(){$body.addClass("top-dd-active").removeClass("show-device-skin-popup show-settings-colorpicker slide-left slide-down"),sett.removeClass("pressed"),exportbtn.removeClass("pressed"),$(".align-icons").toggleClass("visible"),$("#arrange-icons").hasClass("visible"),$(this).hasClass("pressed")&&$body.removeClass("top-dd-active"),$(this).toggleClass("pressed"),$("#arrange-icons").hasClass("visible")&&($("#arrange-icons").removeClass("visible"),$("#arrange").removeClass("pressed"))}),$("#arrange").click(function(){$body.addClass("top-dd-active").removeClass("show-device-skin-popup show-settings-colorpicker slide-left slide-down"),sett.removeClass("pressed"),exportbtn.removeClass("pressed"),$("#arrange-icons").toggleClass("visible"),$(".align-icons").hasClass("visible"),$(this).hasClass("pressed")&&$body.removeClass("top-dd-active"),$(this).toggleClass("pressed"),$(".align-icons").hasClass("visible")&&($(".align-icons").removeClass("visible"),$("#align").removeClass("pressed"))}),$(".inner-btn , #align , #arrange , .pagename-wrap , .appriseInner").click(function(e){e.stopPropagation()}),key("b",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="box",prepareWire(type),insertWire(type))}),key("x",function(e){if(activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length)return e.preventDefault(),void renderIconPicker()}),key("e",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="elipse",prepareWire(type),insertWire(type))}),key("i",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="image",prepareWire(type),insertWire(type))}),key("p",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="paragraph",prepareWire(type),insertWire(type))}),key("l",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="list",prepareWire(type),insertWire(type))}),key("h",function(){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(type="headline",prepareWire(type),insertWire(type))}),key("t",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="headlinetxt",prepareWire(type),insertWire(type))}),key("a",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="annotate",prepareWire(type),insertWire(type))}),key("g",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="line_hor",prepareWire(type),insertWire(type))}),key("v",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="line_vert",prepareWire(type),insertWire(type))}),key("s",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(type),type="slider",prepareWire(type),insertWire(type))}),key("u",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="progressbar",prepareWire(type),insertWire(type))}),key("c",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="combobox",prepareWire(type),insertWire(type))}),key("q",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="scrollh",prepareWire(type),insertWire(type))}),key("y",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="scrollv",prepareWire(type),insertWire(type))}),key("n",function(e){activepage.find(".brandnew").length&&!activepage.find("[contenteditable=true]").length&&(e.preventDefault(),type="textinput",prepareWire(type),insertWire(type))}),key("6",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"#111","border-color":"#111"})),activepage.find(".selected").length&&changeBackgroundColor("#111"))}),key("5",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"#444","border-color":"#444"})),activepage.find(".selected").length&&changeBackgroundColor("#444"))}),key("4",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"#777","border-color":"#777"})),activepage.find(".selected").length&&changeBackgroundColor("#777"))}),key("3",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"#aaa","border-color":"#aaa"})),activepage.find(".selected").length&&changeBackgroundColor("#aaa"))}),key("2",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"#ddd","border-color":"#ddd"})),activepage.find(".selected").length&&changeBackgroundColor("#ddd"))}),key("1",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"#fff","border-color":"#fff"})),activepage.find(".selected").length&&changeBackgroundColor("#fff"))}),key("7",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"tomato","border-color":"tomato"})),activepage.find(".selected").length&&changeBackgroundColor("tomato"))}),key("0",function(){!activepage.find(".brandnew").length&&!activepage.find(".selected").length||activepage.find("[contenteditable=true]").length||(activepage.find(".brandnew").length&&(type="box",prepareWire(type),insertWire(type),activepage.find(".latestwire").css({background:"transparent","border-color":"#444"})),activepage.find(".selected").length&&changeBackgroundColor("transparent"))}),key("alt+7",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("tomato")}),key("alt+1",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("white")}),key("alt+2",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#ddd")}),key("alt+3",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#aaa")}),key("alt+4",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#777")}),key("alt+5",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#444")}),key("alt+6",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("#111")}),key("alt+0",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderColor("transparent")}),key("ctrl+1",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("1")}),key("ctrl+2",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("2")}),key("ctrl+3",function(e){e.preventDefault(),activepage.find(".selected").length&&changeBorderWidth("4")}),key("ctrl+a, command+a",function(e){var t;activepage.find("[contenteditable=true]").length||(e.preventDefault(),(t=activepage.find(".wire").not(".locked , .groupmember")).addClass("selected"),makeDrag(t))}),key("esc",function(e){if(e.preventDefault(),$("input").is(":focus").length&&$("input").is(":focus").blur(),app.activepage.editable&&$.observable(app.activepage).removeProperty("editable"),quill){var t=$(".edited-text"),a=$("body").hasClass("edit-btn");if(blurRTE(),a)return selectWire(t),void editme(t)}deselectAll(),wirepanel.hide(),feuxOverlayClicked(),$("#canvas .blank").remove()}),$container.hasClass("preview")||renderContextMenu(),key("ctrl+up, command+up",function(e){e.preventDefault(),bring_forward()}),key("ctrl+shift+up, command+shift+up",function(e){e.preventDefault(),bring_to_front()}),key("ctrl+shift+down, command+shift+down",function(e){e.preventDefault(),send_to_back()}),key("ctrl+down, command+down",function(e){e.preventDefault(),send_backward()}),key("ctrl+l, command+l",function(e){e.preventDefault(),lock()}),key("ctrl+k, command+k",function(e){e.preventDefault(),makeLink()});var pagelist=$(".sitemap > ol");function makeLink(){var e,t;$(".page").length?($("body").removeClass("show-device-skin-popup top-dd-active"),(e=$("#linkselect")).empty(),e.append($("<option>").append("None").attr("value",0)),$(".sitemap ol li").each(function(){"true"!==$(this).attr("data-hidden")&&$(this).attr("data-pageid")!==app.activepage.id&&e.append($("<option>").append($(this).find(" > .dd-handle").text()).attr("value",$(this).attr("data-pageid")))}),(t=$("#canvas .page:visible .selected").attr("data-link"))&&$("#linkselect option[value="+t+"]").attr("selected",!0),$("#linklist").show().siblings().hide(),positionwirepanel(),wirepanel.show(),e.change(function(){var e=$("#linkselect option:selected").attr("value");$("#canvas .page:visible .selected").attr("data-link",e).addClass("icon-link"),wirepanel.hide()})):alert("You need to be a Premium user to make clickable wireframes.")}function preview(){(previewMode=!previewMode)&&(deselectAll(),$("#top").addClass("topup"),$body.removeClass("slide-left , slide-right , slide-down"),exportbtn.removeClass("pressed"),$(".bottomright, #wirepanel").hide(),$("#canvas .page .wire").draggable("destroy").resizable("destroy").radiusable("destroy").removeClass("ui-resizable-autohide"),$("#canvas").addClass("preview"),$(".ui-boxer").boxer("destroy"),$("#canvas .page").bind("click",highlightclickable),$("#canvas").on("click",".wire[data-link]",gotopage))}$(".pagename-wrap").find(".pagename-top, .sitemap-icon").click(function(){$guidesHV.hide(),wirepanel.hide(),blurRTE(),deselectMaster(),$(".blank").remove(),$(".context-menu-list").length&&$(".context-menu-list").contextMenu("hide"),$("#sitemap-wrap").attr("data-pagetype",app.activepage.type),$("body").hasClass("slide-down")?($("body").removeClass("slide-down"),sharebar.hide(),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"),exportbtn.removeClass("pressed"),$("body").toggleClass("slide-right")):($("body").removeClass("slide-left show-settings-colorpicker , slide-down , show-device-skin-popup"),sett.removeClass("pressed"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sharebar.hide(),$("body").toggleClass("slide-right"),$sitemapicon.toggleClass("icon-sitemap icon-arrow-left"),$("#sitemap-wrap").find("input[type=text]").remove())}),$canvas.find(".wire").each(function(e){1<$('[id="'+this.id+'"]').length&&$('[id="'+this.id+'"]').not($(this)).each(function(e){this.id+=e})}),$("#Link").click(function(){blurRTE(),makeLink()}),$("#preview").click(function(){quill&&blurRTE(),preview()}),$("#re-edit").click(function(){previewMode=!1,makeEditable(),sttngs.removeClass("icon-arrow-right").addClass("icon-cog"),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap")}),$(".linkmark").click(function(e){e.stopPropagation(),$("#Link").click()});var gotopage=function(e){e.stopPropagation();var t=$(this).attr("data-link");0!=t&&make_page_active(t)};function highlightclickable(){var e=$("#canvas .page:visible .wire[data-link]");e.addClass("hilite"),setTimeout(function(){e.removeClass("hilite")},600)}function makeEditable(){$("#top").removeClass("topup"),$(".bottomright").show(),$("#canvas").removeClass("preview"),$("#canvas").off("click",".wire[data-link]",gotopage),$("#canvas .page").unbind("click",highlightclickable),useboxer()}$("#export-btn").click(function(){quill&&blurRTE(),$canvas.find(".wire,.aa").draggable("destroy").resizable("destroy");var e,t,a=$("#include-frame").is(":checked"),i=$("#export-scale").val();$canvaswrap.resizable("destroy"),Boolean(parseInt($("#export-all-pages").val()))?(t=$("#include-hidden").is(":checked")?$canvaswrap.clone().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot").remove().end():$canvaswrap.clone().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot , .page[data-hidden=true]").remove().end(),e=JSON.stringify(getPagesOrder($("#include-hidden").is(":checked"))),0==$canvas.find(".page").not(".masterpage").length&&$canvas.find(".masterpage").length&&(t=t.find(".masterpage").removeClass("masterpage").end())):(activepage.attr("data-applied-master")||activepage.attr("data-applied-master","false"),t=$canvaswrap.clone().find("#grid-div, #gridcol , #guide-h , #guide-v , #grid-dot, .page").not("#"+app.activepage.id+", #"+activepage.attr("data-applied-master").replace(/,/g,", #")).remove().end().end(),activepage.hasClass("masterpage")&&(t=t.find(".masterpage").removeClass("masterpage").end()),e=JSON.stringify([activepage.attr("id")]));var s=t.outerHTML(),n=encodeURIComponent(s);exporting.show(),$.post("../export_png_pdf.php",{data:n,id:filename,extension:$("#export-format input[type='radio']:checked").val(),name:$("title").text(),frame:a,resolution:i,order:e},function(e){$("iframe").attr("src","../download-png-pdf.php?f="+e),MakeCanvasDrag(),exporting.hide()})});var sharebar=$(".sharebar"),exportbtn=$(".export");exportbtn.click(function(){exportbtn.toggleClass("pressed"),$("body").removeClass("show-device-skin-popup top-dd-active"),window.scrollTo(0,0),$("body").hasClass("slide-left")||$("body").hasClass("slide-right")?($("body").removeClass("slide-left , slide-right").toggleClass("slide-down"),sharebar.show(),sett.removeClass("pressed"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),sttngs.removeClass("icon-arrow-right").addClass("icon-cog")):(sharebar.show(),$("body").toggleClass("slide-down"))}),previewMode&&$(".ui-boxer").boxer("destroy"),$(".addComment").click(function(){$("#canvas .page:not(.masterpage):visible").append($("<div class='publiccomment'/>").css({width:"160px",height:"120px",top:"40px",left:"60px","z-index":5e3,position:"absolute"}).append(annotationhtml)),$(".editme").click(divClicked),$("#canvas .thelatest").click()});var $savecomment=$(".saveComment");function saveComment(){$savecomment.show(),$savecomment.bind("click",function(){$("#canvas .page .publiccomment ,#canvas .page .aa").resizable("destroy").draggable("destroy");var e="";$("#canvas .page .publiccomment , #canvas .page .aa").each(function(){$(this).attr("data-parent",$(this).parent().attr("id")),e+=$(this).outerHTML()});var t=encodeURIComponent(e);$.post("../savecomment",{pblcaa:t,preview:previewid},function(){$(".saved").show().delay(600).fadeOut(),$("#canvas .page .publiccomment").draggable({stop:function(){saveComment()}}).resizable({handles:"n,e,w,s",stop:function(){saveComment()}}),$savecomment.unbind("click"),$savecomment.hide()})})}function positionAA(){!function(n){"use strict";n.fn.removeDuplicates=function(){var t=n([]);return this.each(function(e,a){var i,s=n(a);t.each(function(e,t){a.isEqualNode(t)&&(i=!0,s.remove())}),i||(t=t.add(s))}),t}}(jQuery),$(".publiccomment , .aa").removeClass("latestwire").removeDuplicates(),$(".publiccomment , .aa").each(function(){$(this).appendTo($("#"+$(this).attr("data-parent")))})}function getMaxDim(){var e=$canvas.find(".page"),t=e.map(function(){return $(this).attr("data-page-width")}).get(),a=e.map(function(){return $(this).attr("data-page-height")}).get();return{width:Math.max.apply(Math,t),height:Math.max.apply(Math,a)}}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}supercanvas.delegate(".aa","mouseenter",function(){makeAADrag($(this))}),supercanvas.delegate(".publiccomment","mouseenter",function(){$(this).draggable({stop:function(){saveComment()}}).resizable({handles:"n,e,w,s",stop:function(){saveComment()}})}),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("<p>").append(this.eq(0).clone()).html()},window._link_was_clicked=!1,jQuery(document).delegate("a","click",function(e){window._link_was_clicked=!0}),$.fn.hasAttr=function(e){return void 0!==this.attr(e)},jQuery.fn.htmlClean=function(){return this.contents().filter(function(){if(!$(this).hasClass("page")&&!$(this).hasClass("ui-resizable-handle"))return 3!=this.nodeType?void $(this).htmlClean():(this.textContent=$.trim(this.textContent),!/\S/.test(this.nodeValue))}).remove(),this},$canvas.delegate(".grouped:not(.groupmember)","click",function(e){previewMode||(e.ctrlKey||e.shiftKey||e.metaKey||deselectAll(),$(e.target).closest(".grouped"),$(this).hasClass("selected")?$(this).removeClass("selected").resizable("destroy").draggable("destroy").radiusable("destroy").removeClass("ui-resizable-autohide").off():selectElem($(this)))}),$(".grouped:empty").remove(),multipaged&&$("#canvas").boxer("destroy"),function(){var e,i,s,t;multipaged?(e=$canvas.find(".page:visible"),i=$canvaswrap.height(),s=$canvaswrap.width(),$canvaswrap.hasClass("mobile")&&!$canvaswrap.hasClass("tablet")||$canvaswrap.attr("data-template"),$canvaswrap.hasClass("mobile-landscape"),$canvaswrap.hasClass("tablet"),$canvas.find(".page").show().each(function(e){var t,a=$(this);a.attr("data-page-width")||a.attr({"data-page-width":s,"data-page-height":i}),"2"!==$canvaswrap.attr("data-template-version")&&(a.attr("data-orientation","false"),"browser-wrap"==a.attr("data-template")&&(t="browser"),"mobile tablet"==a.attr("data-template")&&(t="tablet"),"mobile"==a.attr("data-template")&&(t="mobile"),"mobile-landscape"==a.attr("data-template")&&(t="mobile",a.attr("data-orientation","landscape")),a.attr("data-template",t),a.removeClass("browser-wrap mobile mobile-landscape tablet")),a.css({height:"100%",width:"100%"})}).not(".active").hide(),"browser-wrap"===(t=e.data("template"))&&(t="browser"),"browser"!==t&&($("#device-indicator").attr("data-device",t),$canvaswrap.removeClass("browser-wrap mobile mobile-landscape tablet").attr("data-template-version","2"))):600<$canvas.height()&&$(".container").css({"overflow-y":"auto"})}(),key("ctrl+s, command+s",function(e){previewMode||(e.preventDefault(),$("#save").click())}),previewMode&&$(".overlay").bind("click contextmenu",function(){($("body").hasClass("slide-left")||$("body").hasClass("slide-right")||$("body").hasClass("slide-down"))&&($("body").removeClass("slide-left , show-settings-colorpicker , slide-right , slide-down"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"))}),$canvas.find(".multidrag").removeClass("multidrag");var $copyBtn=$("#copy-preview-link span"),clipboard=new Clipboard("#copy-preview-link");clipboard.on("success",function(e){$copyBtn.addClass("icon-ok").delay(600).queue(function(){$(this).removeClass("icon-ok").clearQueue()}),e.clearSelection()}),clipboard.on("error",function(e){}),navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)&&$copyBtn.parent().remove(),$("#about-wrap").children().click(function(e){e.stopPropagation()}),$("#about-btn").click(function(e){e.preventDefault(),$("body").addClass("show-about"),wirepanel.hide()}),$.support.transition||($.fn.transition=$.fn.animate);var d1=$("#d1"),dw=$(".demowrap"),c=$("#cursor"),wp=$(".feux-wirepanel"),fc=$(".feux-canvas");function demoStart(){fc.addClass("no-cursor"),c.show().transition({x:"0",y:"0"},0).transition({x:"-130px",y:"-68px"},1600).transition({x:"-130px",y:"-60px",easing:"snap",delay:200},150,demo1)}function demo1(){c.hide(),d1.addClass("draw").removeClass("bg-grey demo-box").css({width:0,height:0}).transition({width:"0",height:"0"},0).show().find(".cursor").show().end().transition({width:"260px",height:"160px",delay:100},2500,demo2)}function demo2(){d1.find(".cursor").hide(),wp.css({top:"-45px",left:"0px"}).show().find(".draw-icons").show().end().find(".edit-icons").hide(),c.show().transition({x:"128px",y:"98px"},0,demo3)}function demo3(){c.transition({x:"-120px",y:"-95px",delay:"600"},1600,demo4)}function demo4(){d1.removeClass("draw").addClass("demo-box"),c.transition({x:"-120px",y:"-91px"},100).transition({x:"-120px",y:"-95px"},100,demo5)}function demo5(){wp.hide(),c.transition({x:"-42px",y:"-35px",delay:"400"},1e3).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150).transition({x:"-42px",y:"-30px"},100).transition({x:"-42px",y:"-35px"},150,demo6)}function demo6(){wp.show().find(".draw-icons").hide().end().find(".edit-icons").show(),c.transition({x:"75px",y:"-95px"},1100).transition({x:"75px",y:"-90px"},100).transition({x:"75px",y:"-95px"},100,demo7)}function demo7(){d1.addClass("bg-grey"),window.setTimeout(demo8,800)}function demo8(){wp.hide(),fc.removeClass("no-cursor"),d1.hide(),dw.hide(),$("#feux-play").show()}$("#feux-play").bind("click",function(){$(this).hide(),dw.show(),localStorage.setItem("demo-watched",!0),demoStart()});var draggingInProgress=!1,zoomfactor=1,oldMath=0,selectedHovered=!1;$canvas.on("mouseenter",".wire.selected",function(){selectedHovered=!0}),$canvas.on("mouseleave",".wire.selected",function(){selectedHovered=!1});var snappedIdH,snappedIdV,mouseOrgClick=!1;function hideGuidesAndMarkers(){$guidesHV.removeClass("visible"),$canvas.data({guideH:!1,guideV:!1}),activepage.add("#canvas > .master-on").find("[data-snap-mark-h],[data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v")}function snapToGuides(r,e,d){if(appSettings.snapToGuides&&appSettings.drawSnap){if($canvas.data("master-dragged")&&!$canvas.data("drawing-in-progress")&&!e.shiftKey&&!e.metaKey)return $guidesHV.hide(),$canvas.data({guideH:!1,guideV:!1}),!1;var l,c,p,a,h=wireDistV=1e3;if(d)$.each(d,function(a,i){var s,n,e=d.id,t=d.isIcon;if("top"==a||"bottom"==a||"heightcenter"==a)for(var o in guides){o!=e&&(c=guides[o].edges,s=Math.min(Math.abs(r.x-c.left),Math.abs(r.x-c.right)),guides.hasOwnProperty(o)&&$.each(guides[o].g,function(e,t){t.hasOwnProperty("x")||"heightcenter"==a&&"c"!==t.pos||Math.abs(t.y-i)<6&&s<h&&(p=$.extend({},this),snappedIdH=o,h=s,p=$.extend(p,{snappedEdge:a,ddh:s}))}))}if("left"==a||"right"==a||"widthcenter"==a)for(var o in guides){o!=e&&(c=guides[o].edges,n=Math.min(Math.abs(r.y-c.top),Math.abs(r.y-c.bottom)),guides.hasOwnProperty(o)&&$.each(guides[o].g,function(e,t){t.hasOwnProperty("y")||Math.abs(t.x-i)<6&&n<wireDistV&&(l=$.extend({},this),snappedIdV=o,wireDistV=n,l=$.extend(l,{snappedEdge:a,ddv:n}))}))}t&&p&&l&&(l.ddv>p.ddh&&(l=!1),l.ddv<p.ddh&&(p=!1))});else for(var t in guides){c=guides[t].edges,a=t;var i=Math.min(Math.abs(r.y-c.top),Math.abs(r.y-c.bottom)),s=Math.min(Math.abs(r.x-c.left),Math.abs(r.x-c.right));guides.hasOwnProperty(t)&&$.each(guides[t].g,function(e,t){Math.abs(t.y-r.y)<6&&s<h&&(p=this,snappedIdH=a,h=s),Math.abs(t.x-r.x)<6&&i<wireDistV&&(l=this,snappedIdV=a,wireDistV=i)})}p?($canvas.data("guideH",p),d||($guideH.addClass("visible").show().css("transform","translateY("+(p.y+$canvas.offset().top+$container.scrollTop()-42)+"px)"),activepage.add("#canvas > .master-on").find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),markAadjacentElement(p,snappedIdH))):($canvas.data("guideH",!1),$guideH.removeClass("visible"),activepage.add("#canvas > .master-on").find("[data-snap-mark-h]").removeAttr("data-snap-mark-h"),$canvas.removeAttr("data-snap-mark")),l?($canvas.data("guideV",l),d||($guideV.addClass("visible").show().css("transform","translateX("+(l.x+$canvas.offset().left+$container.scrollLeft())+"px)"),activepage.add("#canvas > .master-on").find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"),markAadjacentElement(l,snappedIdV))):($canvas.data("guideV",!1),$guideV.removeClass("visible"),activepage.add("#canvas > .master-on").find("[data-snap-mark-v]").removeAttr("data-snap-mark-v"))}}function markAadjacentElement(e,t){activepage.find("[data-snap-mark-"+e.type.slice(0,1)+"]").length||$("#"+t).attr("data-snap-mark-"+e.type.slice(0,1),e.pos)}function removeGuides(e){var i=$(e);if(!i.length)return!1;i.each(function(e,t){var a=$(t).attr("id");delete guides[a],i.is(".grouped")&&i.find(".groupmember").each(function(){delete guides[$(this).attr("id")]})})}function roundHalf(e){return parseFloat((Math.round(2*e)/2).toFixed(1))}function computeGuides(e){var l,c;l=e&&"col"!==e?$(e):"col"===e?$canvas.find(".col"):activepage.find(" > .wire").add($canvas).add(".master-on > .wire"),$.each(l,function(e,t){var a=$(t).position();if($(t).is(".col")&&$(t).is(":visible")){var i=l.outerWidth(),s=l.outerHeight(),n=($canvas.width(),[{type:"v",x:a.left+parseInt(l.css("marginLeft"),10)+1,pos:"w",parent:"col"},{type:"v",x:a.left+parseInt(l.css("marginLeft"),10)+1+i,pos:"e",parent:"col"}]);c=$(t).attr("id");var o={top:a.top,left:a.left+parseInt(l.css("marginLeft"),10)+1,bottom:a.top+s,right:a.left+parseInt(l.css("marginLeft"),10)+1+i}}else if($(t).is("#canvas")){i=$(t).outerWidth()-1;n=[{type:"h",y:0,pos:"n"},{type:"h",y:s=$(t).outerHeight()-1,pos:"s"},{type:"v",x:0,pos:"w"},{type:"v",x:i,pos:"e"},{type:"vm",x:Math.round((i+1)/2),pos:"c"}],c="canvas";o={top:a.top,left:a.left,bottom:a.top+s,right:a.left+i}}else{var r=$(t);if(!isScrolledIntoView(r))return void removeGuides(r);sp={top:0,left:0};var d={top:0,left:0};if($(t).parent().hasClass("master-on")&&(d={top:parseInt(activepage.attr("data-m-pos-y-"+$(t).parent().attr("id")))||0,left:parseInt(activepage.attr("data-m-pos-x-"+$(t).parent().attr("id")))||0}),r.hasClass("groupmember"))return;a={top:roundHalf(r.position().top+sp.top+d.top),left:roundHalf(r.position().left+sp.left+d.left)};var i=roundHalf(r.outerWidth()-1),s=roundHalf(r.outerHeight()-1),n=[{type:"h",y:a.top,pos:"n"},{type:"v",x:a.left,pos:"w"},{type:"hm",y:Math.round(a.top+(s+1)/2)-(s%2==0?1:.5),pos:"c"},{type:"h",y:a.top+s,pos:"s"},{type:"v",x:a.left+i,pos:"e"},{type:"vm",x:Math.round(a.left+(i+1)/2)-(i%2==0?1:.5),pos:"c"}];c=r.attr("id");o={top:a.top,left:a.left,bottom:a.top+s,right:a.left+i}}c&&(guides[c]={g:n,edges:o})})}function feuxOverlayClicked(){return $container.add("body").removeClass("slide-left , show-settings-colorpicker , slide-right , slide-down , top-dd-active , show-device-skin-popup , show-icon-picker"),$("#arrange, #align").removeClass("pressed"),$("#arrange-icons, .align-icons").removeClass("visible"),$sitemapicon.removeClass("icon-arrow-left").addClass("icon-sitemap"),$("#top .settings.pressed").removeClass("pressed"),$("#top .export.pressed").removeClass("pressed"),$("#sitemap-wrap").find("input[type=text]").remove(),app.activepage.new&&blueSitemapInput(),!1}function isScrolledIntoView(e){var t=$(window).scrollTop()+45,a=t+$(window).height(),i=$(e).offset().top,s=i+$(e).height();return t<=s&&s<=a||i<=a&&t<=i}function changePageSize(e,t,a){e&&(supercanvas.width(e+300),a||($canvaswrap.width(e),activepage.attr("data-page-width",e)),$container.perfectScrollbar("update"),$(".share-export").perfectScrollbar("update"),$(".options").perfectScrollbar("update")),t&&(supercanvas.height(t+300),a||($canvaswrap.css("height",t+"px"),activepage.attr("data-page-height",t)),$container.perfectScrollbar("update"),$(".share-export").perfectScrollbar("update"),$(".options").perfectScrollbar("update")),a||updateCanvasInput(e,t)}function hidePageFromPreview(e,a){var t;e instanceof jQuery||(e=$(e)),null==a&&(a=e.data("hidden")||!1),$("#"+e.attr("data-pageid")).add(e).attr("data-hidden",!a),e.is(".dd-parent")&&(t=a?"expand":"collapse",e.find("  button[data-action="+t+"]").click(),e.find("li").each(function(e,t){hidePageFromPreview(t,a)}))}function populateLoremText(){supercanvas.find(".text-lorem [data-lorem-count]").each(function(e,t){var a=$(t).data("lorem-count");$(t).find(".textme").length?$(t).find(".textme").text(paragraphArr.slice(0,a+1).join(" ")):$(t).append("<div>").find("div").addClass("textme").text(paragraphArr.slice(0,a+1).join(" "))})}$canvas.bind("mousemove",$.throttle(70,function(e){if(selectedHovered&&!draggingInProgress||$("body").is('[class*="slide-"]')||previewMode||app&&app.activepage.masterpageSelected||!appSettings.drawOnTop&&!draggingInProgress&&$(e.target).hasClass("wirejr"))return $guidesHV.hide(),!1;var t=Math.round(Math.sqrt(Math.pow(10-e.clientY,2)+Math.pow(10-e.clientX,2)))+"px",a=Math.abs(parseInt(t)-oldMath);oldMath=parseInt(t);var i={x:parseInt(e.pageX-$canvas.offset().left),y:parseInt(e.pageY-$canvas.offset().top)},s=draggingInProgress?draggingInProgress:!1;appSettings.snapOnDraw&&wirepanel.is(":hidden")&&!e.altKey&&a<3&&!quill&&snapToGuides(i,e,s),(e.altKey||3<=a&&!quill)&&hideGuidesAndMarkers(),draggingInProgress||showWireDim({x:$canvas.data("guideV")?$canvas.data("guideV").x:i.x,y:$canvas.data("guideH")?$canvas.data("guideH").y:i.y,w:0,h:0},!0)})).bind("mouseleave",function(){$guidesHV.hide()}),previewMode&&$canvas.unbind("mousemove"),previewMode||computeGuides("#canvas"),$("body > .overlay").bind("click contextmenu",function(e){}),$snaptoguides.bind("change",function(){appSettings.snapToGuides=this.checked,this.checked&&(appSettings.snapToGrid=!1,$snaptogrid.attr("checked",!1),$canvaswrap.attr({"data-grid-snap":"false"}),gridsize=0,appSettings.snapToGrid=!1),$guidesHV.hide(),saveSettings()}),$selectgridtype.change(function(){"graph"==$selectgridtype.val()?($("#grid-div").show(),$("#gridcol , #grid-dot").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","graph"),appSettings.snapToCol=!1,appSettings.snapToGrid=!0,removeGuides(".col")):"dots"==$selectgridtype.val()?($("#grid-dot").show(),$("#gridcol, #grid-div").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","dots"),appSettings.snapToCol=!1,appSettings.snapToGrid=!0,removeGuides(".col")):($("#gridcol").show(),$("#grid-div , #grid-dot").hide(),$showgrid.attr("checked","checked"),$canvaswrap.attr("data-grid-type","col"),appSettings.snapToGrid=!1,appSettings.snapToCol=!0,computeGuides("col")),saveSettings()}),$drawsnap.bind("change",function(){appSettings.drawSnap=this.checked,$guidesHV.hide(),saveSettings()}),$transformsnap.bind("change",function(){appSettings.transformSnap=this.checked,$guidesHV.hide(),saveSettings()}),$container.scroll($.debounce(250,function(){previewMode||computeGuides(activepage.find(" > .wire"))})).perfectScrollbar({handlers:["click-rail","drag-scrollbar","keyboard","wheel"]}),$canvaswrap.bind("mouseleave",function(){$guidesHV.hide()}),$("#sitemap-wrap").delegate(".hidepage","click",function(e){hidePageFromPreview($(this).parent())}),previewMode&&supercanvas.bind("click",function(){$container.add("body").removeClass("slide-right")}),$container.scroll($.debounce(250,!0,function(){$(this).addClass("ps-scrolling")})),$container.scroll($.debounce(750,function(){$(this).removeClass("ps-scrolling")})),jQuery.fn.getShowingText=function(){var e=$(this).width();$("body").append('<div id="TestText" style="padding:0;border:0;height:auto;width:'+e+'px;position:absolute;display:none;"></div>');for(var t=$(this).innerHeight(),a=0,i=!1,s=$("#TestText"),n=(s.innerHeight(),"Lorem"),o=1;o<paragraphArr.length&&a<=t+5;o++)n+=" "+paragraphArr[o],s.text(n),a=s.innerHeight(),paragraphArr[o],o===paragraphArr.length&&(i=!0);return s.remove(),!1===i?(t+5<a&&--o,o<=1&&(o=2),{text:paragraphArr.slice(0,o).join(" "),count:o-1}):paragraphtext},jQuery.fn.selectText=function(){var e,t,a,i;$.browser.mozilla?(e=document,t=this[0],e.body.createTextRange?((i=document.body.createTextRange()).moveToElementText(t),i.select()):window.getSelection&&(a=window.getSelection(),(i=document.createRange()).selectNodeContents(t),a.removeAllRanges(),a.addRange(i))):document.execCommand("selectAll",!1,null)},$canvas.find("div.brandnew").remove();var app,preservedSel={};function setFontSizeSlider(e){var t=e||quill.getSelection().index,a=quill.getFormat(t),i=a.customfontsize||"normal",s=a.lh||"12",n=["1","1.2","1.3","1.4","1.5","1.6","1.8","2","3","4"];fsi=["12px","14px","normal","22px","28px","42px"].indexOf(i),lhsi=0<=n.indexOf(s)?n.indexOf(s):"1.2",$("#wcc-toolbar-instance #font-size-ui-slider").slider("value",fsi),$("#wcc-toolbar-instance #line-height-ui-slider").slider("value",lhsi)}function updateTextTo21(e){if(!e)return!1;var t=$(e);t.parents(".wirejr").hasClass("text-arimo")||t.css("letter-spacing","0");var a={};"bold"!=t.css("fontWeight")&&700!=t.css("fontWeight")||(a.bold="true"),"18px"===t.parents(".wirejr").css("font-size")&&"18px"===t.css("font-size")||(a.size=""!==t.css("font-size")?t.css("font-size"):t.parents(".wirejr").css("font-size"),""!==t[0].style.fontSize&&t.css({"letter-spacing":".18px"}),t.css({"line-height":1.2,"font-size":""}).parents(".wirejr").css({"font-size":""}));var i=$.inArray(t.parents(".text").css("color"),["rgb(255, 255, 255)","rgb(221, 221, 221)","rgb(170, 170, 170)","rgb(119, 119, 119)","rgb(68, 68, 68)","rgb(17, 17, 17)","rgb(255, 99, 71)"]);0<=i&&(a.color=["f","d","a","h7","h4","h1","t"][i]),"start"!==t.css("text-align")&&(a.align=t.css("text-align"),t.css("text-align","")),t.data("text-format",a).unwrap(".text"),t.addClass("ql-editor").removeAttr("contenteditable").parents(".wirejr").addClass("text-arimo").end().parents(".wire").addClass("text21")}function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(0<t)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(0<e.indexOf("Trident/")){var a=e.indexOf("rv:");return parseInt(e.substring(a+3,e.indexOf(".",a)),10)}var i=e.indexOf("Edge/");return 0<i&&parseInt(e.substring(i+5,e.indexOf(".",i)),10)}function makeShareUrl(){if(previewMode)return!1;var e=Boolean(parseInt($("#all-pages").val())),t=(a=$("#shareurl").val()).indexOf("#"),a=a.substring(0,-1!=t?t:a.length);a+=e?"#"+activepage.attr("id"):"",$("#shareurl").val(a),$("a#sharelink").attr("href",a)}function selectWire(e,t,a){wirepanel.hide(),quill&&blurRTE();var i=$(e);selectedHovered=!0,$guidesHV.hide(),t&&(i.toggleClass("selected"),makeDrag(i)),i.hasClass("selected")||activepage.find(".selected").length||controlIconsHide(),i.hasClass("selected")||(showWireDim(i),makeDrag(i),i.addClass("selected").draggable("enable")),controlIconsShow(),a||!(i.is(".hastext")||i.is(".btn")||i.find(".box").length||i.find(".roundbox").length||i.find(".combobox2").length||i.find(".elipse").length)||i.is(".edited-text")||activepage.find("#sel-text").length||i.is(".locked")||i.parents(".master-on").length||i.hasClass("grouped")||!(i.find(".box").length||i.find(".roundbox").length||i.find(".combobox2").length||i.find(".elipse").length)||i.find(".textme").length||i.addClass("btn empty-btn").find(".wirejr").append($("<div>").addClass("textme").css({width:i.width()-2*parseInt(i.find(".wirejr").css("borderLeftWidth")),height:i.height()-2*parseInt(i.find(".wirejr").css("borderLeftWidth"))})),a&&i.radiusable("destroy")}function showWireDim(e,t){e instanceof jQuery&&(e={x:e.position().left,y:e.position().top,w:e.outerWidth(),h:e.outerHeight()}),!1!==e&&void 0!==e.x&&($("#dimcoord").show(),$("#dimcoord").html("<span><b>X:</b> "+e.x+" px</span><span><b>Y:</b> "+e.y+" px</span><span><b>W:</b> "+e.w+" px</span><span><b>H:</b> "+e.h+" px</span>"))}function deselectAll(e){var t=activepage.find(".selected");t.removeClass("selected").resizable("destroy").draggable("destroy").radiusable("destroy").removeClass("ui-resizable-autohide").off(),t.each(function(){$(this).hasClass("empty-btn")&&$(this).removeClass("btn empty-btn").find(".wirejr").empty().off()}),$canvas.data("master-dragged",!1),$canvas.find(".master-on.ui-draggable").length&&deselectMaster(),e||controlIconsHide()}function selectElem(e,t,a){selectWire(e)}function controlIconsHide(){$("#control-icons").find(".pressed").removeClass("pressed").end().find(".visible").removeClass("visible").end().hide()}function controlIconsShow(){$("#lock,#group").removeClass("pressed inactive");var e=activepage.find(".selected");e.length?($("#control-icons").show(),e.length<=1?$("#group").addClass("inactive"):$("#group").removeClass("inactive"),e.hasClass("grouped")&&$("#group").removeClass("inactive").addClass("pressed"),e.hasClass("locked")&&$("#lock").addClass("pressed")):controlIconsHide()}function applyTemplate(e,t){"browser-wrap"===e&&(e="browser"),$canvaswrap.removeClass("browser-wrap mobile tablet"),$("#device-skin-popup").find('span[data-device="'+e+'"]').addClass("selected-template").siblings().removeClass("selected-template"),"none"===e||"browser"===e?($("#device-skin-popup").addClass("no-device"),$canvaswrap.add(activepage).removeAttr("data-orientation")):$("#device-skin-popup").removeClass("no-device"),$("#device-indicator").attr({"data-device":e,"data-orientation":t||"false"}),activepage.add("#canvas-wrap").attr({"data-template":e,"data-orientation":t||"false"}),multipaged&&($.observable(app.pages[app.activepage.id]).setProperty({template:e}),"mobile"!==e&&"tablet"!==e&&$.observable(app.pages[app.activepage.id]).setProperty({orientation:"false"}))}function makeAADrag(e){e.is(":data(draggable)")||e.draggable({cancel:".annotbox , .closeannot",cursor:"move",start:function(){draggingInProgress=!0,$canvaswrap.addClass("draggingInProgress")},stop:function(){draggingInProgress=!1,$canvaswrap.removeClass("draggingInProgress")}}).resizable({handles:"n,e,s,w"})}function positionTextWirepanel(){var e=$("#wcc-toolbar-instance"),t=e.width();e.position().left+t+$canvas.offset().left>$(window).width()&&(e.css("left",$(window).width()-$canvas.offset().left-t-20),wirepanel.css("left",$(window).width()-t+wirepanel.width()-20))}function setVerticalAlignment(e,t){e.find(".textme").css("vertical-align",t),setVertAlignBtn(t)}function setVertAlignBtn(e){"baseline"==(e=e||"middle")&&(e="middle"),$("#wcc-toolbar-instance .ql-vertical-align .ql-picker-label svg").html($(".ql-vertical-align [data-value="+e+"] svg").html()),$("#wcc-toolbar-instance .ql-vertical-align .ql-picker-options .ql-selected").removeClass("ql-selected"),$("#wcc-toolbar-instance .ql-vertical-align [data-value="+e+"]").addClass("ql-selected")}function saveSettings(){localStorage.setItem("settings",JSON.stringify(appSettings))}function applySettings(){var e=JSON.parse(localStorage.getItem("settings"));if(!e)return!1;$.extend(appSettings,e),0==e.drawOnTop&&$("#draw-on-top").attr("checked",!1),!0===e.drawOnTop&&$("#draw-on-top").attr("checked","yes"),e.defaultStyle&&$.each(e.defaultStyle,function(e,t){"fill"===e&&setStyleColorInd(t,"right"),"stroke"===e&&setStyleColorInd(t,"left"),"width"===e&&setStyleWidthInd(t)})}function removeMarkedElemBorder(){activepage.add("#canvas > .master-on").find("[data-snap-mark-h] , [data-snap-mark-v]").removeAttr("data-snap-mark-h").removeAttr("data-snap-mark-v")}function setStyleWidthInd(e){$("#stroke-width-ind").css("height",e)}function setStyleColorInd(e,t){var a=$("#def-style").find(".style-select[data-pos="+t+"] > div");"transparent"==e?(a.css("backgroundColor",""),a.addClass("nocolor")):(a.css("backgroundColor",e),a.removeClass("nocolor"))}function makeScreenshot(s){window.devicePixelRatio,window.chrome&&(window.chrome.webstore||window.chrome.runtime);html2canvas(document.querySelector("#canvas"),{backgroundColor:"#fff",onclone:function(e){$(e).find("#canvas").css({"box-shadow":"none"}).end().find("#grid-dot,#grid-div").remove().end(),$(e).find(".paragraph,.list").each(function(e,t){var a=2*parseInt($(t).find(".txtcont").css("lineHeight"))+"px",i=$(t).find(".txtcont span, .listcont span").css("backgroundColor");$(t).css({background:"",color:i,"background-size":"100%"+a+", 89% "+a}).addClass("paragraph-v2").removeClass("paragraph list").empty()}),$(e).find(".headtext span").css({display:"bloc",float:"left"})},scale:1,x:$("#canvas").offset().left,y:$("#canvas").offset().top,width:$("#canvas").width(),height:$("#canvas").width()/1.68}).then(function(e){var t=document.createElement("canvas");t.setAttribute("width",240*window.devicePixelRatio),t.setAttribute("height",143*window.devicePixelRatio);var a=t.getContext("2d");a.imageSmoothingEnabled=!0,a.webkitImageSmoothingEnabled=!0,a.msImageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(e,0,0,e.width,e.height,0,0,240*window.devicePixelRatio,143*window.devicePixelRatio);var i=JSON.parse(localStorage.getItem("wcc-saved"));i[s].img=e.toDataURL(),localStorage.setItem("wcc-saved",JSON.stringify(i)),localStorage.setItem("imgCanvas",e.toDataURL())})}function scaleIt(e,t){var a=document.createElement("canvas"),i=a.getContext("2d"),s=e.width*t,n=e.height*t;return a.width=s,a.height=n,i.drawImage(e,0,0,s,n),a}function saveThumbAndData(e){var t;saved=JSON.parse(localStorage.getItem("wcc-saved")||"{}"),"order"!=e&&(saved.order||(saved.order=[]),saved[e]||(saved[e]={}),0<=(t=saved.order.indexOf(e))?saved.order.unshift(saved.order.splice(t,1)[0]):saved.order.unshift(e),$.extend(saved[e],{date:Date.now()}),localStorage.setItem("wcc-saved",JSON.stringify(saved)),makeScreenshot(e))}$("#all-pages").change(function(){makeShareUrl()}),$("#feux-font-size-slider").slider({min:0,max:2,value:1,slide:function(e,t){setFeuxFonsSize(t.value)}}),$canvas.delegate(".wire.locked","click",function(e){var t;previewMode||((t=$(e.target).parents(".wire")).parent().hasClass("master-on")||(t.addClass("selected"),$("#lock").addClass("pressed"),controlIconsShow()))}),$canvas.delegate(".wire.grouped","click",function(e){var t;previewMode||(showWireDim(t=$(e.target)),t.addClass("selected"),$("#group").addClass("pressed"))}),$canvas.on("mouseup",".wire.selected",function(e){(e.metaKey||e.shiftKey)&&$(this).hasClass("selected")&&($(this).removeClass("selected").resizable("destroy").draggable("destroy").removeClass("ui-resizable-autohide selected").off(),controlIconsShow())}),-1!=navigator.userAgent.indexOf("Mac OS X")&&$("#top").find("[data-hint]").each(function(){$(this).attr("data-hint",$(this).attr("data-hint").replace("Ctrl",""))}),multipaged||(activepage=$("#canvas"),supercanvas.css({height:$(this).height()+250,width:$(this).width()}),app={activepage:{masterpageSelected:!1}}),$("#device-skin-popup [data-device]").on("click",function(e){var t=$(this).attr("data-device"),a="mobile"===t?["320","480"]:"tablet"===t?["728","1024"]:["1024","728"];$canvaswrap.center(),activepage.find(".wire").length||($canvaswrap.css({width:a[0]+"px",height:a[1]+"px"}).center(),activepage.attr({"data-page-width":a[0],"data-page-height":a[1]})),offset_c=$("#canvas").offset(),updateCanvasInput(),applyTemplate(t)}),$("#device-indicator").click(function(){sett.removeClass("pressed"),exportbtn.removeClass("pressed"),$("body").toggleClass("show-device-skin-popup").removeClass("slide-left slide-down top-dd-active show-settings-colorpicker")}),$("#rotate-btn").on("click",function(){var e;e=(!$canvaswrap.attr("data-orientation")||"false"===$canvaswrap.attr("data-orientation"))&&"landscape",$canvaswrap.add("#device-indicator").add(activepage).attr("data-orientation",e),"mobile"!==activepage.attr("data-template")||activepage.find(".wire").length||(e?($canvaswrap.css({width:"480px",height:"320px"}).center(),activepage.attr({"data-page-width":480,"data-page-height":320})):($canvaswrap.css({width:"320px",height:"480px"}).center(),activepage.attr({"data-page-width":320,"data-page-height":480}))),"tablet"!==activepage.attr("data-template")||activepage.find(".wire").length||(e?($canvaswrap.css({width:"1024px",height:"728px"}).center(),activepage.attr({"data-page-width":1024,"data-page-height":728})):($canvaswrap.css({width:"728px",height:"1024px"}).center(),activepage.attr({"data-page-width":728,"data-page-height":1024}))),multipaged&&$.observable(app.pages[app.activepage.id]).setProperty({orientation:e}),removeGuides("#canvas"),computeGuides("#canvas")}),$.widget("ui.radiusable",{_init:function(){if(!this.element.hasClass("grouped")&&(this.element.find(".box").length||this.element.find(".roundbox").length||this.element.find(".combobox2").length)&&!this.element.find(".ui-border-radius-handle").length){this.element.addClass("wcc-radiusable");for(var c=parseInt(this.element.find(".wirejr").css("borderRadius"),10),e=0;e<=3;e++){this.element.append($("<div>").addClass("ui-border-radius-handle ui-border-radius-handle-"+e).data("pos",e)),this.positionHandles(c);var a=this;this.element.find(".ui-border-radius-handle").draggable({start:function(e,t){saveState(),$(this).parent().removeClass("selected").addClass("ui-radiusable-active"),draggingInProgress=!0},drag:function(e,t){var a=$(this).parent().find(".wirejr"),i=parseInt(a.css("borderLeftWidth"),10),s=a.width()<=a.height()?a.width()/2:a.height()/2,n=s;switch($(this).data("pos")){case 0:t.position.top=t.position.left,(t.position.top<0||t.position.left<0)&&(t.position.left=0,t.position.top=0),(t.position.top>s||t.position.left>s)&&(t.position.left=s,t.position.top=s);var o=t.position.top/n,r=parseInt((s+i)*o,10);a.css("borderRadius",r);break;case 1:t.position.top=a.width()-t.position.left,(t.position.top<0||t.position.left>a.width())&&(t.position.left=a.width(),t.position.top=0),(t.position.top>s||t.position.left<a.width()-s)&&(t.position.left=a.width()-s,t.position.top=s);o=t.position.top/n,r=parseInt((s+i)*o,10);a.css("borderRadius",r);break;case 2:var d=a.height(),l=a.width();t.position.top=d-(l-t.position.left),(t.position.top>d||t.position.left>l)&&(t.position.left=l,t.position.top=d),(t.position.top<d-s||t.position.left<l-s)&&(t.position.left=l-s,t.position.top=d-s);o=(d-t.position.top)/n,r=parseInt((s+i)*o,10);a.css("borderRadius",r);break;case 3:d=a.height(),l=a.width();t.position.top=d-t.position.left,(t.position.top>d||t.position.left<0)&&(t.position.left=0,t.position.top=d),t.position.left>s&&(t.position.left=s,t.position.top=s);o=t.position.left/n,r=parseInt((s+i)*o,10);a.css("borderRadius",r)}c=r},stop:function(e,t){a.positionHandles(c),$(this).parent().addClass("selected").removeClass("ui-radiusable-active"),draggingInProgress=!1}})}}},positionHandles:function(e){e=e||this.element.find(".wirejr").css("borderTopLeftRadius"),e=parseInt(e,10);var a=this.element.width(),i=this.element.height(),t=a<=i?a/2:i/2,s=parseInt(e+12*(1-e/t),10);(t<s||s<=0)&&(s=t-1),this.element.find(".ui-border-radius-handle").each(function(e,t){switch($(this).data("pos")){case 0:$(this).css({top:s,left:s});break;case 1:$(this).css({top:s,left:a-s});break;case 2:$(this).css({top:i-s,left:a-s});break;case 3:$(this).css({top:i-s,left:s})}})},destroy:function(){this._destroy()},_destroy:function(){this.element.removeClass("wcc-radiusable").removeData("radiusable").find(".ui-border-radius-handle").remove()}}),$canvaswrap.on("mousedown",".ql-editor[contenteditable=true], .wcc-toolbar",function(e){e.stopPropagation()}),$("#save-overlay,#close-save-card").on("click",function(){$body.removeClass("show-save-modal")}),$canvas.find(".page > .grouped.wire").css("z-index",""),$("#def-style").on("click",".style-select.-c-p",function(){$body.addClass("show-settings-colorpicker");var e=$(this).data("def-style-attr"),t=$(this).data("pos"),a=appSettings.defaultStyle[e];$("#def-style").attr("data-cp-pos",t),$("#settings-colorpicker").find("[data-val]").removeClass("color-selected").end().find("[data-val="+a+"]").addClass("color-selected")}),$("#def-style").on("click",".style-select.-c-p-w",function(){$body.addClass("show-settings-colorpicker");appSettings.defaultStyle.width;$("#def-style").attr("data-cp-pos","center")}),$(".options").on("click",function(e){$(e.target).hasClass("style-select")||$body.removeClass("show-settings-colorpicker")}),$("#settings-colorpicker").on("click","div",function(){var e=$("#def-style").attr("data-cp-pos"),t=$(this).data("val");$(this).siblings(".color-selected").removeClass("color-selected").end().addClass("color-selected");var a="left"===e?"stroke":"fill";appSettings.defaultStyle[a]=t,saveSettings(),setStyleColorInd(t,e),$body.removeClass("show-settings-colorpicker")}),$("#settings-str-width-picker").on("click","div",function(){var e=$(this).data("val");appSettings.defaultStyle.width=e,saveSettings(),setStyleWidthInd(e),$body.removeClass("show-settings-colorpicker")}),$("#draw-on-top").on("change",function(e,t){appSettings.drawOnTop=$(this).prop("checked"),saveSettings()});var scc=1;function renderIconPicker(){$("body").addClass("show-icon-picker");var e,t,a=activepage.find(".selected").length?activepage.find(".selected"):$canvas.find(".brandnew");a.length&&((e=232<a.position().left+a.width()/2+$canvas.offset().left?a.position().left+a.width()/2+$canvas.offset().left:232)+232>window.innerWidth&&(e=window.innerWidth-268),t=wirepanel.position().top+36+410>window.innerHeight?window.innerHeight-410:wirepanel.position().top+36+50,$("#icon-picker").css({top:t,left:e}),clearIconsSearch(),$("#icons-gallery-wrap").scrollTop(0))}function loadSvgIcons(a){switch(a){case"fa":var e=window.location.pathname.startsWith("/pro/")?"../../wcc-icons/font-awesome-icons.svg":"wcc-icons/font-awesome-icons.svg";break;case"md":e=window.location.pathname.startsWith("/pro/")?"../../wcc-icons/material-design-icons.svg":"wcc-icons/material-design-icons.svg"}var i=new XMLHttpRequest;i.open("GET",e,!0),i.send(),i.onload=function(e){var t=document.createElement("div");t.classList.add("svg-icons-sprite"),t.setAttribute("data-pack",a),t.innerHTML=i.responseText,$("body").append(t)}}function loadHtmlIcons(n,e){$("#icons-gallery-wrap .source-info").hide();var o=new XMLHttpRequest;switch(n){case"fa":var t=window.location.pathname.startsWith("/pro/")?"../../wcc-icons/font-awesome-icons.html":"wcc-icons/font-awesome-icons.html";break;case"md":t=window.location.pathname.startsWith("/pro/")?"../../wcc-icons/material-design-icons.html":"wcc-icons/material-design-icons.html"}o.open("GET",t,!0),o.send(),o.onload=function(e,t){var a=document.querySelector("#icons-gallery"),i=document.querySelector("#icon-picker");a.innerHTML=o.responseText,i.setAttribute("data-pack",n),$("#icons-gallery-wrap .source-info").show();var s=$("#icon-search").val().replace(/[^A-Za-z0-9]+/g,"");$("#icons-gallery div[title*="+s+"]").length&&($("#icons-gallery div").hide(),$("#icons-gallery div[title*="+s+"]").show())},$("#iconset").val(n)}function clearIconsSearch(){$("#search-x").hide(),$("#icons-gallery div").show(),$("#icon-search").val("").focus(),$("#icons-gallery-wrap .source-info").show(),$("#icons-gallery-wrap .no-res").hide()}loadSvgIcons("md"),loadSvgIcons("fa"),previewMode||loadHtmlIcons(appSettings.iconPack),jQuery(document).ready(function(){$("#icon-search").bind("keyup",function(e){"Esc"!=e.key&&"Escape"!=e.key||$("#icon-search").blur();var t=$(this).val().replace(/[^A-Za-z0-9]+/g,"");t.length<2?$("#icons-gallery div").show():($("#search-x").show(),$("#icons-gallery div").hide(),$("#icons-gallery div[title*="+t+"]").length?($("#icons-gallery div[title*="+t+"]").show(),$("#icons-gallery-wrap .source-info").show(),$("#icons-gallery-wrap .no-res").hide()):($("#icons-gallery-wrap .source-info").hide(),$("#icons-gallery-wrap .no-res").show()))})}),$("#search-x").on("click",clearIconsSearch),$("#iconset").on("change",function(){var e=$(this).val();e!=$("#icon-picker").attr("data-pack")&&($("#icon-picker").attr("data-pack",e),$("#icons-gallery").empty(),$("#icons-gallery-wrap .source-info").show(),$("#icons-gallery-wrap .no-res").hide(),loadHtmlIcons(e),$(".svg-icons-sprite[data-pack="+e+"]").length||loadSvgIcons(e),appSettings.iconPack=e,saveSettings())}),$("#icons-gallery").on("click","div",function(){var e=$(this).find("use").attr("xlink:href").replace("#","");$("body").removeClass("show-icon-picker"),activepage.find(".selected").not(".locked").length?(activepage.find(".selected use").attr("xlink:href","#"+e),wirepanel.hide()):prepareWire("w-icon",e)}),$("#wp-icon-picker").click(renderIconPicker);